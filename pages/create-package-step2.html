<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo đơn hàng - Bước 2 - Miền Tây Express</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../css/create-package.css">
    <link rel="stylesheet" href="../css/package_manager.css">

</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-bg">
            <img src="../images/logo-removebg.png" alt="Mien Tay Express Logo" class="logo">
            </div>
        </div>
        <nav class="menu-items" aria-label="Main Navigation">
             <ul>
                 <li><a href="../index.html"><i class="fa-solid fa-house icon"></i><span class="menu-text">TRANG CHỦ</span></a></li>
                 <li><a href="create-package.html"><i class="fa-solid fa-plus icon"></i><span class="menu-text">TẠO ĐƠN HÀNG</span></a></li>
                 <li>
                     <a href="#" class="submenu-parent"> <i class="fa-solid fa-chart-pie icon"></i><span class="menu-text">QUẢN LÝ</span><i class="fa-solid fa-chevron-down submenu-arrow"></i> </a>
                     <div class="submenu">
                         <ul>
                             <li><a href="package_manager.html"><i class="fa-solid fa-box-archive icon"></i><span class="menu-text">Quản lý đơn hàng</span></a></li>
                             <li><a href="straking-bill-of-lading-status.html"><i class="fa-solid fa-list-check icon"></i><span class="menu-text">Quản lý trạng thái</span></a></li>
                             <li><a href="pickup-package.html"><i class="fa-solid fa-truck-fast icon"></i><span class="menu-text">Quản lý vận chuyển</span></a></li>
                             <li><a href="#"><i class="fa-solid fa-building-user icon"></i><span class="menu-text">Quản lý chi nhánh</span></a></li>
                             <li><a href="payment-management.html"><i class="fa-solid fa-dollar-sign icon"></i><span class="menu-text">Quản lý thanh toán</span></a></li>
                         </ul>
                     </div>
                 </li>
                 <li><a href="statistics_management.html"><i class="fa-solid fa-chart-line icon"></i><span class="menu-text">THỐNG KÊ</span></a></li>
                 <li><a href="service-management.html"><i class="fa-solid fa-screwdriver-wrench icon"></i><span class="menu-text">QL DỊCH VỤ</span></a></li>
                 <li>
                     <a href="#" class="submenu-parent"><i class="fa-solid fa-users icon"></i><span class="menu-text">QL KHÁCH HÀNG</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                      <div class="submenu">
                          <ul>
                              <li><a href="#"><span class="menu-text">Danh sách KH</span></a></li>
                              <li><a href="#"><span class="menu-text">Thêm mới KH</span></a></li>
                          </ul>
                      </div>
                 </li>
                  <li>
                      <a href="#" class="submenu-parent"><i class="fa-solid fa-user-tie icon"></i><span class="menu-text">QUẢN LÝ NHÂN SỰ</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                      <div class="submenu">
                          <ul>
                              <li><a href="#"><span class="menu-text">Danh sách NV</span></a></li>
                              <li><a href="#"><span class="menu-text">Phân quyền</span></a></li>
                          </ul>
                      </div>
                  </li>
                 <li><a href="#"><i class="fa-solid fa-circle-info icon"></i><span class="menu-text">THÔNG TIN CÔNG TY</span></a></li>
                  <li>
                      <a href="#" class="submenu-parent"><i class="fa-solid fa-scroll icon"></i><span class="menu-text">QL CHÍNH SÁCH</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                       <div class="submenu">
                          <ul>
                              <li><a href="#"><span class="menu-text">Chính sách A</span></a></li>
                              <li><a href="#"><span class="menu-text">Chính sách B</span></a></li>
                          </ul>
                      </div>
                  </li>
                 <li><a href="#"><i class="fa-solid fa-circle-question icon"></i><span class="menu-text">HƯỚNG DẪN SỬ DỤNG</span></a></li>
                 <li>
                     <a href="#" class="submenu-parent"><i class="fa-solid fa-gear icon"></i><span class="menu-text">CÀI ĐẶT CHUNG</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                      <div class="submenu">
                          <ul>
                             <li><a href="#"><span class="menu-text">Cài đặt A</span></a></li>
                             <li><a href="#"><span class="menu-text">Cài đặt B</span></a></li>
                          </ul>
                      </div>
                  </li>
             </ul>
         </nav>
    </aside>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <main class="main-content">
        <header class="header">
            <button class="mobile-sidebar-toggle" id="mobile-sidebar-toggle" aria-label="Toggle Navigation Menu" aria-controls="sidebar" aria-expanded="false" style="display: inline-flex;"><i class="fa-solid fa-bars"></i></button>
            <div class="header-left">
                <div class="search-container">
                    <i class="fa-solid fa-magnifying-glass search-icon" id="mobile-search-toggle"></i>
                    <input type="text" class="header-search-input" placeholder="Mã vận đơn / Tracking ID...">
                    <div class="mobile-search-overlay" id="mobile-search-overlay" style="display:none;">
                        <input type="text" id="mobile-search-input" class="mobile-search-input" placeholder="Tìm kiếm...">
                        <button id="mobile-search-close" class="icon-button" type="button" aria-label="Đóng tìm kiếm"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>
            </div>
            <div class="header-actions" style="display: flex; align-items: center; gap: 1.2rem; margin-left: auto;">
                <div class="notification-wrapper">
                    <button class="notification-button" id="notification-button" title="Thông báo">
                        <i class="fa-regular fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </button>
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="dropdown-header">Thông báo</div>
                        <ul class="notification-list" id="notification-list">
                            <li class="notification-item" data-title="Thông báo: DỜI CUT OFF CANADA 24/08/2024" data-body="Do lượng hàng T7 (24/08/2024) không đủ tải, chuyến tuyến MTE-CAD sẽ kết nối hàng vào chuyến bay sớm nhất (Cs sẽ update giờ cut off mới)||MTE xin lỗi Quý khách vì sự chậm trễ gây ra bất tiện cho khách hàng.||Rất mong nhận sự thông cảm của Quý khách hàng.||Cs tuyến Canada." data-timestamp="2024-07-25 13:53:27">
                                <div class="item-icon"><i class="fa-solid fa-calendar-xmark"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Dời Cut off Canada 24/08/2024</div>
                                    <div class="item-time">25 Jul 2024</div>
                                </div>
                            </li>
                            <li class="notification-item" data-title="Thông báo: Cập nhật hệ thống" data-body="Hệ thống sẽ được bảo trì vào lúc 02:00 AM ngày 30/07/2024. Vui lòng lưu lại công việc trước thời gian này." data-timestamp="2024-07-28 10:00:00">
                                <div class="item-icon"><i class="fa-solid fa-wrench"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Cập nhật hệ thống 30/07</div>
                                    <div class="item-time">28 Jul 2024</div>
                                </div>
                            </li>
                            <li class="notification-item" data-title="Thông báo: Khuyến mãi mới" data-body="Chương trình khuyến mãi hè 2024 đã bắt đầu! Giảm giá 10% cho các tuyến đi Mỹ." data-timestamp="2024-07-20 09:00:00">
                                <div class="item-icon"><i class="fa-solid fa-tags"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Khuyến mãi hè 2024!</div>
                                    <div class="item-time">20 Jul 2024</div>
                                </div>
                            </li>
                        </ul>
                        <div class="dropdown-footer"><a href="#">Xem tất cả</a></div>
                    </div>
                </div>
                <div class="user-container" style="position: relative;">
                    <div class="user-dropdown-toggle" id="user-dropdown-toggle" style="display: flex; align-items: center; gap: 6px; background: #6366f1; border-radius: 7px; padding: 6px 14px; cursor: pointer;">
                        <i class="fa-regular fa-circle-user user-icon" id="user-icon" style="color: #fff; font-size: 1.25em;"></i>
                </div>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fa-regular fa-circle-user"></i>
                            </div>
                            <div class="user-details">
                                <h4>Nguyễn Văn A</h4>
                                <span class="user-role">Quản trị viên</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="user-dropdown-item"><i class="fa-regular fa-user"></i> Thông tin cá nhân</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-gear"></i> Cài đặt tài khoản</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-bell"></i> Thông báo</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-shield-halved"></i> Bảo mật</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a>
            </div>
                </div>
            </div>
        </header>

        <div class="content-wrapper">
            <section class="page-header">
                 <div class="page-header-left">
                     <h1 class="page-title">Tạo đơn hàng</h1>
                     <nav class="breadcrumb" aria-label="breadcrumb"> <a href="#">Tạo đơn hàng</a> / <span>Step 2</span> </nav>
                 </div>
             </section>

             <section class="content-area-step2">
                 <form id="create-order-step2-form" novalidate>
                     <div class="content-layout summary-flex-2col">
                         <div class="summary-col-left">
                             <article class="card summary-card" aria-labelledby="order-summary-heading">
                                 <div class="card-header summary-header">
                                     <h2 id="order-summary-heading" class="card-title"><i class="fas fa-receipt icon"></i> Tóm tắt đơn hàng</h2>
                                     <a href="create-package.html" class="edit-step1-link button secondary small" title="Sửa thông tin Step 1">
                                         <i class="fas fa-pencil-alt"></i> Sửa Step 1
                                     </a>
                                 </div>
                                 <div class="card-body summary-body">
                                     <div class="summary-section order-service-summary">
                                         <div class="summary-grid-2col">
                                             <div class="summary-label"><i class="fas fa-barcode"></i> Mã đơn hàng:</div>
                                             <div class="summary-value"><input type="text" id="summary-order-code" value="MTE24091302145" readonly></div>
                                             <div class="summary-label"><i class="fas fa-hashtag"></i> REF Code:</div>
                                             <div class="summary-value">3012659134</div>
                                             <div class="summary-label"><i class="fas fa-truck"></i> Dịch vụ:</div>
                                             <div class="summary-value">MTE DHL SIN</div>
                                             <div class="summary-label"><i class="fas fa-building"></i> Chi nhánh:</div>
                                             <div class="summary-value">Tân Phú - HCM</div>
                                             <div class="summary-label"><i class="fas fa-shield-alt"></i> Dịch vụ kèm:</div>
                                             <div class="summary-value">Chữ Ký / Bảo hiểm hàng hóa</div>
                                             <div class="summary-label"><i class="fas fa-box"></i> Loại gửi:</div>
                                             <div class="summary-value">Hàng hóa</div>
                                             <div class="summary-label"><i class="fas fa-truck-pickup"></i> Gửi hàng:</div>
                                             <div class="summary-value">Thu gom tận nơi</div>
                                             <div class="summary-label"><i class="fas fa-exclamation-circle"></i> Yêu cầu:</div>
                                             <div class="summary-value">Vùng sâu vùng xa / Không xuất Hóa Đơn</div>
                                             <div class="summary-label"><i class="fas fa-user-tie"></i> Đại lý:</div>
                                             <div class="summary-value">Quý Nam</div>
                                             <div class="summary-label"><i class="fas fa-user-cog"></i> Điều phối:</div>
                                             <div class="summary-value">OPS: Đặng Văn Cường - OP.. | CS: Alice in the Wonder L..</div>
                                         </div>
                                     </div>
                                 </div>
                             </article>
                         </div>
                         <div class="summary-col-right">
                             <article class="card summary-card sender-card" aria-labelledby="sender-summary-heading">
                                 <div class="card-header summary-header">
                                     <h3 id="sender-summary-heading" class="card-title"><i class="fas fa-user icon"></i> Người gửi</h3>
                                 </div>
                                 <div class="card-body summary-body">
                                     <div class="summary-info-row"> <span class="info-label">Tên:</span> <span class="info-value">TRẦN PHÚC ĐƯỜNG</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Công ty:</span> <span class="info-value">Công ty TNHH Thương Mại và Dịch Vụ Nina</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Địa chỉ:</span> <span class="info-value">Tòa nhà Sài Gòn Tel, CVPM Quang Trung, P. Tân Chánh Hiệp, Q.12, TP.CHM, Việt Nam</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Điện thoại:</span> <span class="info-value">0909951549</span> </div>
                                 </div>
                             </article>
                             <article class="card summary-card receiver-card" aria-labelledby="receiver-summary-heading">
                                 <div class="card-header summary-header">
                                     <h3 id="receiver-summary-heading" class="card-title"><i class="fas fa-box-open icon"></i> Người nhận</h3>
                                 </div>
                                 <div class="card-body summary-body">
                                     <div class="summary-info-row"> <span class="info-label">Tên:</span> <span class="info-value">Alice the Alexander KPOP Woo Chun Pyoh Kamsahamita</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Công ty:</span> <span class="info-value">HIEP THANH RUBBER INDUSTRIES CORPORATION</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Địa chỉ:</span> <span class="info-value">80 Don Avenue Rumford, Rhode Island 02916 US</span> </div>
                                     <div class="summary-info-row"> <span class="info-label">Điện thoại:</span> <div class="multi-value"> <span>+1 14014261999</span> <span>+1 14014171995</span> </div> </div>
                                 </div>
                             </article>
                         </div>
                     </div>

                     <div class="mobile-scroll-wrapper">
                         <div class="content-layout data-layout">
                         <section class="card form-section data-section">
                             <div class="card-header">
                                 <h2 class="card-title"><i class="fa-solid fa-weight-hanging icon"></i> Thông tin kiện hàng<span class="required">*</span></h2>
                                 <span class="header-note">DIM: <label for="dim_factor" class="visually-hidden">DIM Factor</label><input type="number" id="dim_factor" value="5000" title="DIM Factor"></span>
                             </div>
                             <div class="card-body">
                                 <div class="form-group">
                                     <label for="product_name">Tên sản phẩm:</label>
                                     <input type="text" id="product_name" name="product_name" value="Hàng cá nhân">
                                     <span class="error-message"></span>
                                 </div>
                                 <div class="form-group dimension-group">
                                     <div class="dimension-labels">
                                         <span>Dài (cm)</span> <span>Rộng (cm)</span> <span>Cao (cm)</span> <span>Nặng (kg)</span>
                                         <span class="visually-hidden">Hành động</span>
                                     </div>
                                     <div id="dimension-rows">
                                         <div class="dimension-row">
                                             <label for="dim_length_1" class="visually-hidden">Dài kiện 1</label> <input type="number" step="any" id="dim_length_1" name="dim_length[]" value="12.51">
                                             <label for="dim_width_1" class="visually-hidden">Rộng kiện 1</label> <input type="number" step="any" id="dim_width_1" name="dim_width[]" value="30.51">
                                             <label for="dim_height_1" class="visually-hidden">Cao kiện 1</label> <input type="number" step="any" id="dim_height_1" name="dim_height[]" value="42">
                                             <label for="dim_weight_1" class="visually-hidden">Nặng kiện 1</label> <input type="number" step="any" id="dim_weight_1" name="dim_weight[]" value="13.21">
                                             <div class="dim-actions">
                                             </div>
                                         </div>
                                         <div class="dimension-row">
                                             <label for="dim_length_2" class="visually-hidden">Dài kiện 2</label> <input type="number" step="any" id="dim_length_2" name="dim_length[]" value="12">
                                             <label for="dim_width_2" class="visually-hidden">Rộng kiện 2</label> <input type="number" step="any" id="dim_width_2" name="dim_width[]" value="30.51">
                                             <label for="dim_height_2" class="visually-hidden">Cao kiện 2</label> <input type="number" step="any" id="dim_height_2" name="dim_height[]" value="23">
                                             <label for="dim_weight_2" class="visually-hidden">Nặng kiện 2</label> <input type="number" step="any" id="dim_weight_2" name="dim_weight[]" value="8.5">
                                             <div class="dim-actions">
                                                 <button type="button" class="icon-button add-dim confirm small" title="Thêm kiện"><i class="fas fa-plus-circle"></i></button>
                                                 <button type="button" class="icon-button remove-dim danger small" title="Xóa kiện"><i class="fas fa-times-circle"></i></button>
                                             </div>
                                         </div>
                                     </div>
                                 </div>
                                 <div class="form-group">
                                     <label for="shipment_notes">Nội dung ghi chú:</label>
                                     <textarea id="shipment_notes" name="shipment_notes"></textarea>
                                      <span class="error-message"></span>
                                 </div>
                                 <div class="form-group">
                                     <span class="form-label">Ảnh đính kèm:</span>
                                     <div class="attachment-group">
                                         <input type="file" id="shipment_images" name="shipment_images[]" multiple accept="image/jpeg, image/png" class="visually-hidden">
                                         <button type="button" class="button secondary small file-trigger-button" aria-controls="shipment_images"> <i class="fas fa-image"></i> Chọn ảnh </button>
                                         <span class="file-type-note">(.jpg/.png/.jpeg)</span>
                                         <div class="checkbox-group"> <label><input type="checkbox" name="is_fragile" value="1" checked> Hàng dễ vỡ</label> </div>
                                     </div>
                                     <div class="selected-files-container" id="selected_files_list"> <span class="no-files-selected"><i>Chưa chọn file nào.</i></span> </div>
                                      <span class="error-message"></span>
                                 </div>
                                 <div class="form-group">
                                     <label for="image_link">Link ảnh kiện:</label>
                                     <input type="text" id="image_link" name="image_link" value="https://drive.google.com/file/d/1mhqWcodHc3gPu40IrEp3cg8Mh7yYG9QY/view">
                                      <span class="error-message"></span>
                                 </div>
                             </div>
                         </section>

                         <section class="card form-section data-section">
                              <div class="card-header">
                                 <h2 class="card-title"><i class="fa-solid fa-clipboard-list icon"></i> Chi tiết hàng hóa</h2>
                                 <div class="header-action">
                                     <label for="package_select" class="visually-hidden">Chọn kiện</label>
                                     <select id="package_select" name="package_select"> <option value="1" selected>Kiện 01</option> <option value="2">Kiện 02</option> </select>
                                 </div>
                              </div>
                              <div class="card-body">
                                  <div class="table-responsive-wrapper">
                                     <table class="shipment-details-table data-table" aria-describedby="shipment-details-legend">
                                         <caption id="shipment-details-legend" class="visually-hidden">Bảng chi tiết hàng hóa trong kiện</caption>
                                         <colgroup> <col class="col-action"> <col class="col-name"> <col class="col-qty"> <col class="col-unit"> <col class="col-price"> <col class="col-total"> </colgroup>
                                         <thead> <tr> <th><span class="visually-hidden">Hành động</span></th> <th>Tên hàng hóa</th> <th>SL</th> <th>Loại</th> <th>Đơn giá (USD)</th> <th>Tổng</th> </tr> </thead>
                                         <tbody id="shipment-items-tbody">
                                             <tr>
                                                  <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng 1"><i class="fas fa-trash-alt"></i></button></td>
                                                  <td><label for="item_name_1" class="visually-hidden">Tên hàng hóa dòng 1</label><textarea id="item_name_1" name="item_name[]" rows="1">wooden Buddha Statue</textarea></td>
                                                  <td><label for="item_quantity_1" class="visually-hidden">Số lượng dòng 1</label><input type="number" id="item_quantity_1" name="item_quantity[]" value="10" min="1"></td>
                                                  <td><label for="item_unit_1" class="visually-hidden">Loại dòng 1</label><select id="item_unit_1" name="item_unit[]"> <option value="PCE" selected>PCE</option> <option value="PCS">PCS</option> <option value="PKG">PKG</option> <option value="Rolls">Rolls</option> </select> </td>
                                                  <td><label for="item_price_1" class="visually-hidden">Đơn giá dòng 1</label><input type="number" step="any" id="item_price_1" name="item_price[]" value="5000"></td>
                                                  <td><label for="item_total_1" class="visually-hidden">Tổng giá dòng 1</label><input type="number" step="any" id="item_total_1" name="item_total[]" value="50000" readonly></td>
                                              </tr>
                                              <tr>
                                                  <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng 2"><i class="fas fa-trash-alt"></i></button></td>
                                                  <td><label for="item_name_2" class="visually-hidden">Tên hàng hóa dòng 2</label><textarea id="item_name_2" name="item_name[]" rows="1">Dried shrimp</textarea></td>
                                                  <td><label for="item_quantity_2" class="visually-hidden">Số lượng dòng 2</label><input type="number" id="item_quantity_2" name="item_quantity[]" value="20" min="1"></td>
                                                  <td><label for="item_unit_2" class="visually-hidden">Loại dòng 2</label><select id="item_unit_2" name="item_unit[]"> <option value="PCE">PCE</option> <option value="PCS" selected>PCS</option> <option value="PKG">PKG</option> <option value="Rolls">Rolls</option> </select> </td>
                                                  <td><label for="item_price_2" class="visually-hidden">Đơn giá dòng 2</label><input type="number" step="any" id="item_price_2" name="item_price[]" value="10"></td>
                                                  <td><label for="item_total_2" class="visually-hidden">Tổng giá dòng 2</label><input type="number" step="any" id="item_total_2" name="item_total[]" value="200" readonly></td>
                                              </tr>
                                              <tr>
                                                  <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng 3"><i class="fas fa-trash-alt"></i></button></td>
                                                  <td><label for="item_name_3" class="visually-hidden">Tên hàng hóa dòng 3</label><textarea id="item_name_3" name="item_name[]" rows="1">Khô heo từ nhà SatraFood ngon hết xẩy</textarea></td>
                                                  <td><label for="item_quantity_3" class="visually-hidden">Số lượng dòng 3</label><input type="number" id="item_quantity_3" name="item_quantity[]" value="5" min="1"></td>
                                                  <td><label for="item_unit_3" class="visually-hidden">Loại dòng 3</label><select id="item_unit_3" name="item_unit[]"> <option value="PCE">PCE</option> <option value="PCS">PCS</option> <option value="PKG" selected>PKG</option> <option value="Rolls">Rolls</option> </select> </td>
                                                  <td><label for="item_price_3" class="visually-hidden">Đơn giá dòng 3</label><input type="number" step="any" id="item_price_3" name="item_price[]" value="3"></td>
                                                  <td><label for="item_total_3" class="visually-hidden">Tổng giá dòng 3</label><input type="number" step="any" id="item_total_3" name="item_total[]" value="15" readonly></td>
                                              </tr>
                                              <tr>
                                                  <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng 4"><i class="fas fa-trash-alt"></i></button></td>
                                                  <td><label for="item_name_4" class="visually-hidden">Tên hàng hóa dòng 4</label><textarea id="item_name_4" name="item_name[]" rows="3">Cuộn nhãn sea food - Seafood sticker roll Manufacturer: 533/6 National Highway 1A, Quarter 1, An Phu Dong Ward, District 12, Ho Chi Minh City</textarea></td>
                                                  <td><label for="item_quantity_4" class="visually-hidden">Số lượng dòng 4</label><input type="number" id="item_quantity_4" name="item_quantity[]" value="6" min="1"></td>
                                                  <td><label for="item_unit_4" class="visually-hidden">Loại dòng 4</label><select id="item_unit_4" name="item_unit[]"> <option value="PCE">PCE</option> <option value="PCS">PCS</option> <option value="PKG">PKG</option> <option value="Rolls" selected>Rolls</option> </select> </td>
                                                  <td><label for="item_price_4" class="visually-hidden">Đơn giá dòng 4</label><input type="number" step="any" id="item_price_4" name="item_price[]" value="10"></td>
                                                  <td><label for="item_total_4" class="visually-hidden">Tổng giá dòng 4</label><input type="number" step="any" id="item_total_4" name="item_total[]" value="60" readonly></td>
                                              </tr>
                                         </tbody>
                                         <tfoot> <tr> <td colspan="5"><strong>Tổng trị giá đơn hàng:</strong></td> <td><strong id="total-order-value">5275</strong></td> </tr> </tfoot>
                                     </table>
                                 </div>
                                  <button type="button" class="button secondary small add-item-button" onclick="addItemRow(event)"> <i class="fas fa-plus"></i> Thêm dòng </button>
                              </div>
                         </section>
                         </div>
                     </div>

                     <footer class="form-actions content-actions">
                         <div class="confirmation-check terms-agreement">
                            <input type="checkbox" id="confirm_info" name="confirm_info" required>
                            <label for="confirm_info">Vui lòng kiểm tra và điền <strong>đầy đủ</strong> các thông tin</label>
                            <span class="error-message"></span>
                         </div>
                         <div class="action-buttons">
                             <button type="button" class="button secondary" onclick="window.location.href='create-package.html';"> <i class="fa-solid fa-arrow-left"></i> Quay lại </button>
                             <button type="button" class="button warning" onclick="resetRightColumn()"> <i class="fa-solid fa-arrows-rotate"></i> Làm mới </button>
                             <button type="submit" class="button confirm" form="create-order-step2-form"> <i class="fa-solid fa-eye"></i> Xem chi tiết</button>
                         </div>
                     </footer>
                 </form>
             </section>

             <footer class="site-footer">
                 Miền Tây Express © <span id="current-year"></span>. All rights reserved. Design by Nina Co.,Ltd
             </footer>

        </div>
    </main>

    <div class="announcement-overlay" id="announcement-overlay">
        <div class="announcement-box" id="announcement-box">
            <div class="announcement-header">
                <h3 id="announcement-title">Tiêu đề thông báo</h3>
                <button class="announcement-close-btn" id="announcement-close-btn" title="Đóng thông báo">×</button>
            </div>
            <div class="announcement-body" id="announcement-body">
                Nội dung chi tiết của thông báo sẽ được hiển thị ở đây.
            </div>
            <div class="announcement-footer">
                <span id="announcement-timestamp">Thời gian</span>
            </div>
        </div>
    </div>

     <script>
         const body = document.body;
         const sidebar = document.getElementById('sidebar');
         const sidebarOverlay = document.getElementById('sidebar-overlay');
         const mobileSidebarToggleBtn = document.getElementById('mobile-sidebar-toggle');
         const currentDateSpan = document.getElementById('current-date');
         const currentTimeSpan = document.getElementById('current-time');
         const currentYearSpan = document.getElementById('current-year');
         const fullscreenBtn = document.getElementById('fullscreen-btn');

         const manageBodyScroll = () => {
             const isSidebarOpen = body.classList.contains('sidebar-mobile-open');
             const isAnyModalVisible = document.querySelector('.modal-overlay.active, .announcement-overlay.visible');
             body.classList.toggle('overflow-hidden', isSidebarOpen || isAnyModalVisible);
         };

         function toggleSidebarMobileOrDesktop() {
             if (window.innerWidth > 768) {
             body.classList.toggle('sidebar-collapsed');
             const isCollapsed = body.classList.contains('sidebar-collapsed');
             if (isCollapsed) {
                 document.querySelectorAll('.menu-items .submenu.active').forEach(submenu => {
                     submenu.classList.remove('active');
                     const parentLink = submenu.previousElementSibling;
                     if(parentLink?.classList.contains('submenu-parent')) {
                        parentLink.classList.remove('active');
                        parentLink.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(0deg)');
                     }
                 });
             } else {
                initializeActiveSubmenu();
             }
             } else {
                 body.classList.toggle('sidebar-mobile-open');
             }
             const isOpen = body.classList.contains('sidebar-mobile-open') || !body.classList.contains('sidebar-collapsed');
             if (mobileSidebarToggleBtn) mobileSidebarToggleBtn.setAttribute('aria-expanded', String(isOpen));
             manageBodyScroll();
         }

         function toggleSubmenu(event) {
             event.preventDefault();
             if (body.classList.contains('sidebar-collapsed') && window.innerWidth > 768) return;
             const parentLink = event.currentTarget;
             const submenuWrapper = parentLink.nextElementSibling;
             const arrow = parentLink.querySelector('.submenu-arrow');

             if (!submenuWrapper || !submenuWrapper.classList.contains('submenu')) return;
             const isActive = submenuWrapper.classList.contains('active');

             document.querySelectorAll('.menu-items .submenu-parent.active').forEach(activeParent => {
                 if (activeParent !== parentLink) {
                     activeParent.classList.remove('active');
                     activeParent.nextElementSibling?.classList.remove('active');
                     activeParent.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(0deg)');
                 }
             });

             submenuWrapper.classList.toggle('active', !isActive);
             parentLink.classList.toggle('active', !isActive);
             if (arrow) arrow.style.setProperty('transform', !isActive ? 'rotate(180deg)' : 'rotate(0deg)');
         }

         function initializeActiveSubmenu() {
             document.querySelectorAll('.menu-items .submenu-parent').forEach(parentLink => {
                 const submenuDiv = parentLink.nextElementSibling;
                 const arrow = parentLink.querySelector('.submenu-arrow');
                 if (submenuDiv?.classList.contains('submenu')) {
                     const hasActiveChild = submenuDiv.querySelector('a.active');
                     const shouldBeActive = hasActiveChild && (!body.classList.contains('sidebar-collapsed') || window.innerWidth <= 768);

                     submenuDiv.classList.toggle('active', shouldBeActive);
                     parentLink.classList.toggle('active', shouldBeActive);
                     if (arrow) arrow.style.setProperty('transform', shouldBeActive ? 'rotate(180deg)' : 'rotate(0deg)');
                 }
             });
         }

         function updateDateTime() {
             const now = new Date();
             const optionsDate = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
             const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
             if (currentDateSpan) currentDateSpan.textContent = now.toLocaleDateString('en-GB', optionsDate).replace(/,/g, '');
             if (currentTimeSpan) currentTimeSpan.textContent = now.toLocaleTimeString('en-US', optionsTime);
             if (currentYearSpan) currentYearSpan.textContent = now.getFullYear();
         }

         function toggleFullscreen() {
             if (!document.fullscreenElement) {
                 document.documentElement.requestFullscreen().catch(err => console.error(`Fullscreen error: ${err.message}`));
             } else if (document.exitFullscreen) {
                 document.exitFullscreen();
             }
         }

         function handleFullscreenChange() {
              const isFullscreen = !!document.fullscreenElement;
              const icon = fullscreenBtn?.querySelector('i');
              if(icon){
                  icon.classList.toggle('fa-expand', !isFullscreen);
                  icon.classList.toggle('fa-compress', isFullscreen);
              }
               if(fullscreenBtn) {
                   fullscreenBtn.setAttribute('title', isFullscreen ? 'Exit Fullscreen' : 'Fullscreen');
               }
         }

         document.addEventListener('DOMContentLoaded', () => {
             initializeActiveSubmenu();
             updateDateTime();
             setInterval(updateDateTime, 1000);
             if (mobileSidebarToggleBtn) mobileSidebarToggleBtn.addEventListener('click', toggleSidebarMobileOrDesktop);
             if (sidebarOverlay) sidebarOverlay.addEventListener('click', toggleSidebarMobileOrDesktop);
             document.querySelectorAll('.menu-items .submenu-parent').forEach(link => link.addEventListener('click', toggleSubmenu));
             if (fullscreenBtn) fullscreenBtn.addEventListener('click', toggleFullscreen);
             document.addEventListener('fullscreenchange', handleFullscreenChange);

            const form = document.getElementById('create-order-step2-form');
            const itemTableBody = document.getElementById('shipment-items-tbody');
            const dimensionRowsContainer = document.getElementById('dimension-rows');
            const submitButton = document.querySelector('button.button.confirm[form="create-order-step2-form"]');
            const selectImagesBtn = document.querySelector('.file-trigger-button');
            const fileInput = document.getElementById('shipment_images');
            const fileListDisplay = document.getElementById('selected_files_list');

            if (submitButton && form) { submitButton.addEventListener('click', handleFormSubmit); }
            if (itemTableBody) { itemTableBody.addEventListener('input', handleTableInput); itemTableBody.addEventListener('click', handleTableClick); }
            if(dimensionRowsContainer) { dimensionRowsContainer.addEventListener('click', handleDimensionClick); }
            if (selectImagesBtn && fileInput) { selectImagesBtn.addEventListener('click', () => fileInput.click() ); }
            if (fileInput && fileListDisplay) { fileInput.addEventListener('change', handleFileSelection); }
            if (fileListDisplay) { fileListDisplay.addEventListener('click', handleRemoveFile); }

            updateTotalOrderValue();
            calculateAllItemTotals();
            ensureAddButtonOnLastRow();
         });

       function handleFormSubmit(event) {
           const form = document.getElementById('create-order-step2-form');
           const confirmCheckbox = document.getElementById('confirm_info');
           let isValid = true;

           form.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
           form.querySelectorAll('.error-message').forEach(el => el.remove());
           form.querySelectorAll('label[style*="color"], .form-label[style*="color"]').forEach(lbl => lbl.style.color = '');

           if (!form.checkValidity()) {
                const firstInvalid = form.querySelector(':invalid');
                if (firstInvalid) {
                     firstInvalid.classList.add('error');
                     addErrorMessage(firstInvalid.closest('.form-group') || firstInvalid.parentElement, firstInvalid.validationMessage || 'Trường này là bắt buộc.');
                     firstInvalid.focus();
                }
               isValid = false;
           }

           const confirmContainer = confirmCheckbox.closest('.confirmation-check');
           if (!confirmCheckbox.checked) {
               alert('Vui lòng xác nhận đã kiểm tra và điền đầy đủ thông tin.');
               confirmCheckbox.focus();
               if(confirmContainer) confirmContainer.querySelector('label').style.color = 'var(--danger-color)';
               addErrorMessage(confirmContainer, 'Vui lòng xác nhận.');
               isValid = false;
           } else {
                if(confirmContainer) confirmContainer.querySelector('label').style.color = '';
                removeErrorMessage(confirmContainer);
           }

           if (!isValid) {
               event.preventDefault();
               return false;
           }

           const formData = new FormData(form);
           const fileInput = document.getElementById('shipment_images');
           const displayedFileNames = Array.from(document.querySelectorAll('#selected_files_list li span:first-child')).map(span => span.textContent);
           const filesToAppend = Array.from(fileInput.files).filter(file => displayedFileNames.includes(file.name));
           formData.delete(fileInput.name);
           filesToAppend.forEach(file => { formData.append(fileInput.name, file); });

           console.log('Form data to be submitted:');
           for (let [key, value] of formData.entries()) {
               if (value instanceof File) { console.log(`${key}:`, value.name, `(size: ${value.size} bytes)`); }
               else { console.log(`${key}:`, value); }
           }

           event.preventDefault();
           alert('Đơn hàng đã được xác nhận và xem chi tiết (demo)!');
       }

       function handleTableInput(e) {
            if (e.target.matches('input[name="item_quantity[]"], input[name="item_price[]"]')) {
                calculateItemTotal(e.target.closest('tr'));
                updateTotalOrderValue();
            }
       }

       function handleTableClick(e) {
            if (e.target.closest('.remove-item')) {
                e.target.closest('tr').remove();
                updateTotalOrderValue();
            }
       }

       function handleDimensionClick(e) {
            const addButton = e.target.closest('.add-dim');
            const removeButton = e.target.closest('.remove-dim');

            if (addButton) { addDimensionRow(); }
            else if (removeButton) {
                 const rows = document.querySelectorAll('#dimension-rows .dimension-row');
                 if (rows.length > 1) { removeButton.closest('.dimension-row').remove(); }
                 else { alert("Phải có ít nhất một kiện hàng."); }
                 ensureAddButtonOnLastRow();
            }
        }

       function handleFileSelection(event) {
           const fileListDisplay = document.getElementById('selected_files_list');
           const files = event.target.files;
           fileListDisplay.innerHTML = '';
           const list = document.createElement('ul');
           list.className = 'file-list';

           if (files.length > 0) {
               Array.from(files).forEach((file, index) => {
                   const listItem = document.createElement('li');
                   const fileNameSpan = document.createElement('span');
                   fileNameSpan.textContent = file.name;
                   listItem.appendChild(fileNameSpan);

                   const removeBtnSpan = document.createElement('span');
                   removeBtnSpan.innerHTML = `<button type="button" class="icon-button remove-file-btn danger small" title="Xóa ${file.name}" data-file-name="${file.name}" data-file-index="${index}"><i class="fas fa-times"></i></button>`;
                   listItem.appendChild(removeBtnSpan);
                   list.appendChild(listItem);
               });
               fileListDisplay.appendChild(list);
           } else {
               fileListDisplay.innerHTML = '<span class="no-files-selected"><i>Chưa chọn file nào.</i></span>';
           }
       }

       function handleRemoveFile(event) {
           const removeButton = event.target.closest('.remove-file-btn');
           if (removeButton) {
               const fileNameToRemove = removeButton.dataset.fileName;
               removeButton.closest('li').remove();

               const fileListDisplay = document.getElementById('selected_files_list');
               const remainingItems = fileListDisplay.querySelectorAll('li');
               if (remainingItems.length === 0) {
                    fileListDisplay.innerHTML = '<span class="no-files-selected"><i>Chưa chọn file nào.</i></span>';
                    document.getElementById('shipment_images').value = '';
               }
            }
       }

        function calculateItemTotal(row) {
            if (!row) return;
            const quantityInput = row.querySelector('input[name="item_quantity[]"]');
            const priceInput = row.querySelector('input[name="item_price[]"]');
            const totalInput = row.querySelector('input[name="item_total[]"]');
            const quantity = parseFloat(quantityInput?.value) || 0;
            const price = parseFloat(priceInput?.value) || 0;
            if (totalInput) totalInput.value = (quantity * price).toFixed(0);
        }

        function calculateAllItemTotals() {
            const rows = document.querySelectorAll('#shipment-items-tbody tr');
            rows.forEach(row => calculateItemTotal(row));
        }

        function updateTotalOrderValue() {
            let grandTotal = 0;
            const totalInputs = document.querySelectorAll('#shipment-items-tbody input[name="item_total[]"]');
            totalInputs.forEach(input => { grandTotal += parseFloat(input.value) || 0; });
            const totalValueDisplay = document.getElementById('total-order-value');
            if(totalValueDisplay) { totalValueDisplay.textContent = grandTotal.toFixed(0); }
        }

       function addDimensionRow() {
           const container = document.getElementById('dimension-rows');
           if (!container) return;
           const newIndex = Date.now();
           const newRowHTML = `
               <div class="dimension-row">
                   <label for="dim_length_${newIndex}" class="visually-hidden">Dài kiện ${newIndex}</label> <input type="number" step="any" id="dim_length_${newIndex}" name="dim_length[]" placeholder="Dài">
                   <label for="dim_width_${newIndex}" class="visually-hidden">Rộng kiện ${newIndex}</label> <input type="number" step="any" id="dim_width_${newIndex}" name="dim_width[]" placeholder="Rộng">
                   <label for="dim_height_${newIndex}" class="visually-hidden">Cao kiện ${newIndex}</label> <input type="number" step="any" id="dim_height_${newIndex}" name="dim_height[]" placeholder="Cao">
                   <label for="dim_weight_${newIndex}" class="visually-hidden">Nặng kiện ${newIndex}</label> <input type="number" step="any" id="dim_weight_${newIndex}" name="dim_weight[]" placeholder="Nặng">
                   <div class="dim-actions"></div>
               </div>`;
           container.insertAdjacentHTML('beforeend', newRowHTML);
           ensureAddButtonOnLastRow();
       }

        function ensureAddButtonOnLastRow() {
            const container = document.getElementById('dimension-rows');
            if (!container) return;
            const rows = container.querySelectorAll('.dimension-row');
            rows.forEach((row, index) => {
                const actionsDiv = row.querySelector('.dim-actions');
                if (!actionsDiv) return;
                actionsDiv.innerHTML = '';
                if (rows.length > 1) {
                    actionsDiv.innerHTML += `<button type="button" class="icon-button remove-dim danger small" title="Xóa kiện"><i class="fas fa-times-circle"></i></button>`;
                }
                if (index === rows.length - 1) {
                    actionsDiv.innerHTML += `<button type="button" class="icon-button add-dim confirm small" title="Thêm kiện"><i class="fas fa-plus-circle"></i></button>`;
                }
            });
        }

       function addItemRow(event) {
           if(event) event.preventDefault();
           const tbody = document.getElementById('shipment-items-tbody');
           if (!tbody) return;
           const newIndex = Date.now();
           const newRowHTML = `
               <tr>
                   <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng"><i class="fas fa-trash-alt"></i></button></td>
                   <td><label for="item_name_${newIndex}" class="visually-hidden">Tên hàng hóa dòng ${newIndex}</label><textarea id="item_name_${newIndex}" name="item_name[]" rows="1"></textarea></td>
                   <td><label for="item_quantity_${newIndex}" class="visually-hidden">Số lượng dòng ${newIndex}</label><input type="number" id="item_quantity_${newIndex}" name="item_quantity[]" value="1" min="1"></td>
                   <td><label for="item_unit_${newIndex}" class="visually-hidden">Loại dòng ${newIndex}</label><select id="item_unit_${newIndex}" name="item_unit[]"> <option value="PCE" selected>PCE</option> <option value="PCS">PCS</option> <option value="PKG">PKG</option> <option value="Rolls">Rolls</option> </select></td>
                   <td><label for="item_price_${newIndex}" class="visually-hidden">Đơn giá dòng ${newIndex}</label><input type="number" step="any" id="item_price_${newIndex}" name="item_price[]" value="0"></td>
                   <td><label for="item_total_${newIndex}" class="visually-hidden">Tổng giá dòng ${newIndex}</label><input type="number" step="any" id="item_total_${newIndex}" name="item_total[]" value="0" readonly></td>
               </tr>`;
           tbody.insertAdjacentHTML('beforeend', newRowHTML);
       }

       function resetRightColumn() {
            const rightColumn = document.querySelector('.content-column-right');
            if (rightColumn) {
                rightColumn.querySelectorAll('.data-section').forEach(section => {
                    section.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
                         if(input.defaultValue !== undefined) { input.value = input.defaultValue; }
                         else { input.value = ''; }
                         input.classList.remove('error');
                    });
                    section.querySelectorAll('select').forEach(select => {
                        const defaultOption = select.querySelector('option[selected]');
                        select.selectedIndex = defaultOption ? defaultOption.index : 0;
                        select.classList.remove('error');
                    });
                    section.querySelectorAll('input[type="checkbox"]').forEach(checkbox => { checkbox.checked = checkbox.defaultChecked; });
                    section.querySelectorAll('.error-message').forEach(msg => msg.remove());
                });

                const dimensionContainer = document.getElementById('dimension-rows');
                if (dimensionContainer) {
                    dimensionContainer.innerHTML = `
                        <div class="dimension-row">
                            <label for="dim_length_1" class="visually-hidden">Dài kiện 1</label> <input type="number" step="any" id="dim_length_1" name="dim_length[]" placeholder="Dài">
                            <label for="dim_width_1" class="visually-hidden">Rộng kiện 1</label> <input type="number" step="any" id="dim_width_1" name="dim_width[]" placeholder="Rộng">
                            <label for="dim_height_1" class="visually-hidden">Cao kiện 1</label> <input type="number" step="any" id="dim_height_1" name="dim_height[]" placeholder="Cao">
                            <label for="dim_weight_1" class="visually-hidden">Nặng kiện 1</label> <input type="number" step="any" id="dim_weight_1" name="dim_weight[]" placeholder="Nặng">
                            <div class="dim-actions">
                                <button type="button" class="icon-button add-dim confirm small" title="Thêm kiện"><i class="fas fa-plus-circle"></i></button>
                            </div>
                        </div>`;
                }

                const itemTableBody = document.getElementById('shipment-items-tbody');
                if (itemTableBody) {
                    itemTableBody.innerHTML = `
                        <tr>
                            <td><button type="button" class="icon-button remove-item danger small" title="Xóa dòng"><i class="fas fa-trash-alt"></i></button></td>
                            <td><label for="item_name_1" class="visually-hidden">Tên hàng hóa dòng 1</label><textarea id="item_name_1" name="item_name[]" rows="1"></textarea></td>
                            <td><label for="item_quantity_1" class="visually-hidden">Số lượng dòng 1</label><input type="number" id="item_quantity_1" name="item_quantity[]" value="1" min="1"></td>
                            <td><label for="item_unit_1" class="visually-hidden">Loại dòng 1</label><select id="item_unit_1" name="item_unit[]"><option value="PCE" selected>PCE</option><option value="PCS">PCS</option><option value="PKG">PKG</option><option value="Rolls">Rolls</option></select></td>
                            <td><label for="item_price_1" class="visually-hidden">Đơn giá dòng 1</label><input type="number" step="any" id="item_price_1" name="item_price[]" value="0"></td>
                            <td><label for="item_total_1" class="visually-hidden">Tổng giá dòng 1</label><input type="number" step="any" id="item_total_1" name="item_total[]" value="0" readonly></td>
                        </tr>`;
                    updateTotalOrderValue();
                }

                const fileListDisplay = document.getElementById('selected_files_list');
                const fileInput = document.getElementById('shipment_images');
                if (fileListDisplay) { fileListDisplay.innerHTML = '<span class="no-files-selected"><i>Chưa chọn file nào.</i></span>'; }
                if (fileInput) { fileInput.value = ''; }
            }
       }

         function addErrorMessage(container, message) {
             if (!container) return;
             const existingError = container.querySelector('.error-message');
             if (existingError) existingError.remove();
             const errorSpan = document.createElement('span');
             errorSpan.className = 'error-message';
             errorSpan.textContent = message;
             container.appendChild(errorSpan);
         }

         function removeErrorMessage(container) {
              if (!container) return;
             const errorMessages = container.querySelectorAll('.error-message');
             errorMessages.forEach(msg => msg.remove());
         }

        document.addEventListener('DOMContentLoaded', function() {
            // Lấy dữ liệu từ localStorage
            const data = JSON.parse(localStorage.getItem('createPackageStep1') || '{}');
            // Hàm ánh xạ value sang tên dịch vụ
            function getServiceName(val) {
                const map = {
                    'signature': 'Chữ Ký',
                    'fumigation': 'FUMIGATION',
                    'packing': 'Đóng kiện gỗ',
                    'insurance': 'Bảo hiểm hàng hóa'
                };
                return map[val] || val;
            }
            // Kiểm tra đủ 4 section bắt buộc
            const requiredFields = [
                // Người gửi
                'sender_name', 'sender_phone', 'sender_address',
                // Người nhận
                'receiver_name', 'receiver_phone1', 'receiver_address',
                // Dịch vụ
                'service_type', 'branch', 'package_type', 'pickup_method',
                // Yêu cầu đơn hàng
                'bill_status', 'agent'
            ];
            const missing = requiredFields.filter(f => !data[f] || data[f].toString().trim() === '');
            if (missing.length > 0) {
                alert('Thiếu thông tin bắt buộc ở bước 1. Vui lòng nhập lại!');
                window.location.href = 'create-package.html';
                return;
            }
            // Hiển thị thông tin Người gửi
            const senderCard = document.querySelector('.sender-card .summary-body');
            if(senderCard) {
                senderCard.innerHTML = `
                    <div class="summary-info-row"> <span class="info-label">Tên:</span> <span class="info-value">${data.sender_name || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Công ty:</span> <span class="info-value">${data.sender_company || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Địa chỉ:</span> <span class="info-value">${data.sender_address || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Điện thoại:</span> <span class="info-value">${data.sender_phone || ''}</span> </div>
                `;
            }
            // Hiển thị thông tin Người nhận
            const receiverCard = document.querySelector('.receiver-card .summary-body');
            if(receiverCard) {
                receiverCard.innerHTML = `
                    <div class="summary-info-row"> <span class="info-label">Tên:</span> <span class="info-value">${data.receiver_name || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Công ty:</span> <span class="info-value">${data.receiver_company || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Địa chỉ:</span> <span class="info-value">${data.receiver_address || ''}</span> </div>
                    <div class="summary-info-row"> <span class="info-label">Điện thoại:</span> <span class="info-value">${(data.receiver_phone1_code||'') + ' ' + (data.receiver_phone1||'')}</span> </div>
                `;
            }
            // Hiển thị thông tin Dịch vụ
            const orderServiceSummary = document.querySelector('.order-service-summary .summary-grid-2col');
            if(orderServiceSummary) {
                let addServiceArr = data['add_service[]'];
                if (typeof addServiceArr === 'string') addServiceArr = [addServiceArr];
                if (!Array.isArray(addServiceArr)) addServiceArr = [];
                const addServiceText = addServiceArr.map(getServiceName).join(' / ');
                orderServiceSummary.innerHTML = `
                    <div class="summary-label"><i class="fas fa-truck"></i> Dịch vụ:</div>
                    <div class="summary-value">${data.service_type || ''}</div>
                    <div class="summary-label"><i class="fas fa-building"></i> Chi nhánh:</div>
                    <div class="summary-value">${data.branch || ''}</div>
                    <div class="summary-label"><i class="fas fa-shield-alt"></i> Dịch vụ kèm:</div>
                    <div class="summary-value">${addServiceText}</div>
                    <div class="summary-label"><i class="fas fa-box"></i> Loại gửi:</div>
                    <div class="summary-value">${data.package_type || ''}</div>
                    <div class="summary-label"><i class="fas fa-truck-pickup"></i> Gửi hàng:</div>
                    <div class="summary-value">${data.pickup_method || ''}</div>
                `;
            }
            // Hiển thị thông tin Yêu cầu đơn hàng
            const orderSummary = document.querySelector('.order-service-summary .summary-grid-2col');
            if(orderSummary) {
                orderSummary.innerHTML += `
                    <div class="summary-label"><i class="fas fa-exclamation-circle"></i> Yêu cầu:</div>
                    <div class="summary-value">${data.bill_status || ''}</div>
                    <div class="summary-label"><i class="fas fa-user-tie"></i> Đại lý:</div>
                    <div class="summary-value">${data.agent || ''}</div>
                    <div class="summary-label"><i class="fas fa-user-cog"></i> OPS:</div>
                    <div class="summary-value">${data.ops_coord || ''}</div>
                    <div class="summary-label"><i class="fas fa-user-cog"></i> CS:</div>
                    <div class="summary-value">${data.cs_handler || ''}</div>
                    <div class="summary-label"><i class="fas fa-hashtag"></i> Mã INV:</div>
                    <div class="summary-value">${data.invoice_code || ''}</div>
                `;
            }
        });

        // --- Dropdown user đăng nhập/đăng xuất ---
        document.addEventListener('DOMContentLoaded', function() {
            function renderUserDropdown() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const userToggle = document.getElementById('user-dropdown-toggle');
                const userDropdown = document.getElementById('user-dropdown');
                if (!userToggle || !userDropdown) return;
                if (!isLoggedIn) {
                    userToggle.innerHTML = `
                        <div style="background: linear-gradient(135deg, #ffe066 0%, #a78bfa 100%); border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;">
                            <i class="fa-regular fa-circle-user user-icon" style="color: #4F46E5; font-size: 1.5em;"></i>
                        </div>
                    `;
                    userDropdown.innerHTML = `
                        <a href="#" class="user-dropdown-item" id="login-menu-item">
                            <i class="fa-solid fa-right-to-bracket"></i> Đăng nhập
                        </a>
                    `;
                } else {
                    userToggle.innerHTML = `
                        <div>
                            <i class="fa-regular fa-circle-user user-icon" style="color: #4F46E5; font-size: 1.5em;"></i>
                        </div>
                    `;
                    userDropdown.innerHTML = `
                        <div class="user-info">
                            <div class="user-avatar"><i class="fa-regular fa-circle-user"></i></div>
                            <div class="user-details">
                                <div>Phạm Hoàng Đình</div>
                                <div>Quản trị viên</div>
                            </div>
                        </div>
                        <hr>
                        <a href="#" class="user-dropdown-item"><i class="fa-regular fa-user"></i> Thông tin cá nhân</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-gear"></i> Cài đặt tài khoản</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-bell"></i> Thông báo</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-shield-halved"></i> Bảo mật</a>
                        <hr>
                        <a href="#" class="user-dropdown-item" id="logout-menu-item"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a>
                    `;
                }
                setTimeout(() => {
                    const loginItem = document.getElementById('login-menu-item');
                    if (loginItem) loginItem.onclick = function(e) { e.preventDefault(); window.location.href = 'login.html'; };
                    const logoutItem = document.getElementById('logout-menu-item');
                    if (logoutItem) logoutItem.onclick = function(e) { e.preventDefault(); localStorage.removeItem('isLoggedIn'); window.location.reload(); };
                }, 100);
            }
            renderUserDropdown();
            window.addEventListener('storage', renderUserDropdown);
            // Dropdown show/hide
            const userToggle = document.getElementById('user-dropdown-toggle');
            const userDropdown = document.getElementById('user-dropdown');
            if(userToggle && userDropdown){
                userToggle.addEventListener('click', function(e){
                    e.stopPropagation();
                    userDropdown.classList.toggle('show');
                });
                document.addEventListener('click', function(e){
                    if(!userDropdown.contains(e.target) && e.target !== userToggle){
                        userDropdown.classList.remove('show');
                    }
                });
            }
        });
        // --- Dropdown thông báo ---
document.addEventListener('DOMContentLoaded', function() {
            const notificationButton = document.getElementById('notification-button');
            const notificationDropdown = document.getElementById('notification-dropdown');
            const notificationList = document.getElementById('notification-list');
            const announcementOverlay = document.getElementById('announcement-overlay');
            const announcementBox = document.getElementById('announcement-box');
            const announcementTitle = document.getElementById('announcement-title');
            const announcementBodyEl = document.getElementById('announcement-body');
            const announcementTimestamp = document.getElementById('announcement-timestamp');

            function toggleNotificationDropdown() {
                if (notificationDropdown) {
                    notificationDropdown.classList.toggle('visible');
                }
            }

            function closeNotificationDropdown() {
                 if (notificationDropdown) {
                    notificationDropdown.classList.remove('visible');
                 }
            }

            function showAnnouncement() {
                if (announcementOverlay) {
                    announcementOverlay.classList.add('visible');
            document.body.classList.add('overflow-hidden');
                }
            }

            function closeAnnouncement() {
                if (announcementOverlay) {
                    announcementOverlay.classList.remove('visible');
            document.body.classList.remove('overflow-hidden');
        }
    }

    if (notificationButton) notificationButton.addEventListener('click', (event) => { event.stopPropagation(); toggleNotificationDropdown(); });
            if (notificationList) {
                notificationList.addEventListener('click', (event) => {
                    const clickedItem = event.target.closest('.notification-item');
                    if (clickedItem && announcementTitle && announcementBodyEl && announcementTimestamp) {
                        const title = clickedItem.dataset.title || 'Thông báo';
                        const bodyText = clickedItem.dataset.body || 'Không có nội dung.';
                        const timestamp = clickedItem.dataset.timestamp || '';
                        announcementTitle.textContent = title;
                        announcementBodyEl.innerHTML = '';
                        bodyText.split('||').forEach(paragraphText => {
                            if(paragraphText.trim()) {
                                const p = document.createElement('p');
                                p.textContent = paragraphText.trim();
                                announcementBodyEl.appendChild(p);
                            }
                        });
                        announcementTimestamp.textContent = timestamp;
                        showAnnouncement();
                        closeNotificationDropdown();
                    }
                });
            }
            document.addEventListener('click', (event) => {
                if (notificationDropdown && notificationDropdown.classList.contains('visible')) {
                    if (!notificationDropdown.contains(event.target) && event.target !== notificationButton && !notificationButton.contains(event.target)) {
                        closeNotificationDropdown();
                    }
                }
            });
    const announcementCloseBtn = document.getElementById('announcement-close-btn');
    if (announcementCloseBtn) announcementCloseBtn.addEventListener('click', closeAnnouncement);
            if (announcementOverlay) {
        announcementOverlay.addEventListener('click', (event) => { if (event.target === announcementOverlay) closeAnnouncement(); });
                    }
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (announcementOverlay && announcementOverlay.classList.contains('visible')) {
                        closeAnnouncement();
                    } else if (notificationDropdown && notificationDropdown.classList.contains('visible')) {
                        closeNotificationDropdown();
                    }
                }
            });
        });
    </script>
</body>
</html>