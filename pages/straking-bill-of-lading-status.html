<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trạng thái Theo dõi Vận đơn - Mien Tay Express</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../css/package_manager.css">
    <link rel="stylesheet" href="../css/straking_bill.css">
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../images/logo-removebg.png" alt="Mien Tay Express Logo" class="logo">
        </div>
        <nav class="menu-items" aria-label="Main Navigation">
            <ul>
                <li><a href="../index.html" class="active"><i class="fa-solid fa-house icon"></i><span class="menu-text">TRANG CHỦ</span></a></li>
                <li><a href="create-package.html"><i class="fa-solid fa-plus icon"></i><span class="menu-text">TẠO ĐƠN HÀNG</span></a></li>
                <li>
                    <a href="#" class="submenu-parent"> <i class="fa-solid fa-chart-pie icon"></i><span class="menu-text">QUẢN LÝ</span><i class="fa-solid fa-chevron-down submenu-arrow"></i> </a>
                    <div class="submenu">
                        <ul>
                            <li><a href="package_manager.html"><i class="fa-solid fa-box-archive icon"></i><span class="menu-text">Quản lý đơn hàng</span></a></li>
                            <li><a href="straking-bill-of-lading-status.html"><i class="fa-solid fa-list-check icon"></i><span class="menu-text">Quản lý trạng thái</span></a></li>
                            <li><a href="pickup-package.html"><i class="fa-solid fa-truck-fast icon"></i><span class="menu-text">Quản lý vận chuyển</span></a></li>
                            <li><a href="#"><i class="fa-solid fa-building-user icon"></i><span class="menu-text">Quản lý chi nhánh</span></a></li>
                            <li><a href="payment-management.html"><i class="fa-solid fa-dollar-sign icon"></i><span class="menu-text">Quản lý thanh toán</span></a></li>
                        </ul>
                    </div>
                </li>
                <li><a href="statistics_management.html"><i class="fa-solid fa-chart-line icon"></i><span class="menu-text">THỐNG KÊ</span></a></li>
                <li><a href="service-management.html"><i class="fa-solid fa-screwdriver-wrench icon"></i><span class="menu-text">QL DỊCH VỤ</span></a></li>
                <li><a href="customer-list.html"><i class="fa-solid fa-users icon"></i><span class="menu-text">QL KHÁCH HÀNG</span></a></li>
                <li><a href="employee-list.html"><i class="fa-solid fa-user-tie icon"></i><span class="menu-text">QUẢN LÝ NHÂN SỰ</span></a></li>
                <li><a href="#"><i class="fa-solid fa-circle-info icon"></i><span class="menu-text">THÔNG TIN CÔNG TY</span></a></li>
                <li>
                    <a href="#" class="submenu-parent"><i class="fa-solid fa-scroll icon"></i><span class="menu-text">QL CHÍNH SÁCH</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                    <div class="submenu">
                        <ul>
                            <li><a href="#"><span class="menu-text">Chính sách A</span></a></li>
                            <li><a href="#"><span class="menu-text">Chính sách B</span></a></li>
                        </ul>
                    </div>
                </li>
                <li><a href="#"><i class="fa-solid fa-circle-question icon"></i><span class="menu-text">HƯỚNG DẪN SỬ DỤNG</span></a></li>
                <li>
                    <a href="#" class="submenu-parent"><i class="fa-solid fa-gear icon"></i><span class="menu-text">CÀI ĐẶT CHUNG</span><i class="fa-solid fa-chevron-down submenu-arrow"></i></a>
                    <div class="submenu">
                        <ul>
                            <li><a href="#"><span class="menu-text">Cài đặt A</span></a></li>
                            <li><a href="#"><span class="menu-text">Cài đặt B</span></a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
    </aside>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <main class="main-content">
        <header class="header">
            <button class="mobile-sidebar-toggle" id="mobile-sidebar-toggle" aria-label="Toggle Navigation Menu" aria-controls="sidebar" aria-expanded="false"> <i class="fa-solid fa-bars"></i> </button>
            <div class="header-left">
                <div class="search-container">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    <input type="text" class="header-search-input" placeholder="Mã vận đơn / Tracking ID...">
                </div>
            </div>
            <div class="header-actions" style="display: flex; align-items: center; gap: 1.2rem; margin-left: auto;">
                <div class="notification-wrapper">
                    <button class="notification-button" id="notification-button" title="Thông báo">
                        <i class="fa-regular fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </button>
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="dropdown-header">Thông báo</div>
                        <ul class="notification-list" id="notification-list">
                            <li class="notification-item" data-title="Thông báo: DỜI CUT OFF CANADA 24/08/2024" data-body="Do lượng hàng T7 (24/08/2024) không đủ tải, chuyến tuyến MTE-CAD sẽ kết nối hàng vào chuyến bay sớm nhất (Cs sẽ update giờ cut off mới)||MTE xin lỗi Quý khách vì sự chậm trễ gây ra bất tiện cho khách hàng.||Rất mong nhận sự thông cảm của Quý khách hàng.||Cs tuyến Canada." data-timestamp="2024-07-25 13:53:27">
                                <div class="item-icon"><i class="fa-solid fa-calendar-xmark"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Dời Cut off Canada 24/08/2024</div>
                                    <div class="item-time">25 Jul 2024</div>
                                </div>
                            </li>
                            <li class="notification-item" data-title="Thông báo: Cập nhật hệ thống" data-body="Hệ thống sẽ được bảo trì vào lúc 02:00 AM ngày 30/07/2024. Vui lòng lưu lại công việc trước thời gian này." data-timestamp="2024-07-28 10:00:00">
                                <div class="item-icon"><i class="fa-solid fa-wrench"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Cập nhật hệ thống 30/07</div>
                                    <div class="item-time">28 Jul 2024</div>
                                </div>
                            </li>
                            <li class="notification-item" data-title="Thông báo: Khuyến mãi mới" data-body="Chương trình khuyến mãi hè 2024 đã bắt đầu! Giảm giá 10% cho các tuyến đi Mỹ." data-timestamp="2024-07-20 09:00:00">
                                <div class="item-icon"><i class="fa-solid fa-tags"></i></div>
                                <div class="item-content">
                                    <div class="item-title">Khuyến mãi hè 2024!</div>
                                    <div class="item-time">20 Jul 2024</div>
                                </div>
                            </li>
                        </ul>
                        <div class="dropdown-footer"><a href="#">Xem tất cả</a></div>
                    </div>
                </div>
                <div class="user-container" style="position: relative;">
                    <div class="user-dropdown-toggle" id="user-dropdown-toggle" style="display: flex; align-items: center; gap: 6px; background: #6366f1; border-radius: 7px; padding: 6px 14px; cursor: pointer;">
                        <i class="fa-regular fa-circle-user user-icon" id="user-icon" style="color: #fff; font-size: 1.25em;"></i>
                    </div>
                    <div class="user-dropdown" id="user-dropdown">
                        <a href="#" class="user-dropdown-item" id="profile-link"><i class="fa-regular fa-user"></i> Profile</a>
                        <a href="#" class="user-dropdown-item" id="login-link"><i class="fa-solid fa-right-to-bracket"></i> Đăng nhập</a>
                        <a href="#" class="user-dropdown-item" id="logout-link"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-wrapper">
            <section class="page-header">
                <div class="page-header-left">
                    <h1 class="page-title">Theo Dõi Trạng thái Vận đơn - MTE192775</h1>
                    <nav class="breadcrumb" aria-label="breadcrumb">
                        <a href="#">Quản lý</a> / <span>Quản lý trạng thái</span>
                    </nav>
                </div>
            </section>

            <div class="straking-content-screenshot">
                <form id="tracking-status-form">
                    <section class="top-section-ss">
                        <div class="action-bar-ss">
                            <div class="status-selector-ss">
                                <i class="fas fa-tags"></i>
                                <label for="tracking_status_select">Trạng thái đơn hàng</label>
                                <select id="tracking_status_select" name="tracking_status">
                                    <option value="received">Nhận yêu cầu đơn hàng</option>
                                    <option value="warehouse">Đã nhận hàng về kho</option>
                                    <option value="shipping" selected>Hàng đang vận chuyển</option>
                                    <option value="delivered">Đã giao hàng</option>
                                </select>
                            </div>
                            <div class="action-buttons-ss">
                                <button type="button" class="button danger btn-cancel-ss"><i class="fa-solid fa-xmark"></i> Thoát</button>
                                <button type="submit" class="button confirm btn-update-ss"><i class="fa-solid fa-check"></i> Cập nhật</button>
                            </div>
                        </div>

                        <div class="progress-bar-ss" id="shipment-progress">
                            <div class="progress-line-ss"></div>
                            <div class="progress-step-ss completed" data-label="Nhận yêu cầu đơn hàng">
                                <div class="step-icon-ss"><i class="fa-solid fa-file-alt"></i></div>
                            </div>
                            <div class="progress-step-ss completed" data-label="Đã nhận hàng về kho">
                                <div class="step-icon-ss"><i class="fa-solid fa-warehouse"></i></div>
                            </div>
                            <div class="progress-step-ss active" data-label="Hàng đang vận chuyển">
                                <div class="step-icon-ss"><i class="fa-solid fa-truck"></i></div>
                            </div>
                            <div class="progress-step-ss" data-label="Đã giao hàng">
                                <div class="step-icon-ss"><i class="fa-solid fa-box-open"></i></div>
                            </div>
                        </div>
                        <div class="step-labels-ss">
                            <span>Nhận yêu cầu đơn hàng</span>
                            <span>Đã nhận hàng về kho</span>
                            <span>Hàng đang vận chuyển</span>
                            <span>Đã giao hàng</span>
                        </div>
                    </section>

                    <div class="content-columns-ss">
                        <div class="column-left-ss">
                            <section class="card info-card-ss">
                                <header class="card-header info-header-ss">
                                    <h2 class="card-title"><i class="fas fa-box-open"></i> Thông tin kiện hàng</h2>
                                    <button type="button" class="icon-button section-toggle-btn" title="Thu gọn/Mở rộng"><i class="fas fa-chevron-up"></i></button>
                                </header>
                                <div class="card-body info-body-ss">
                                    <h3 class="info-group-title-ss"><i class="fa-solid fa-ticket"></i> Thông tin dịch vụ</h3>
                                    <dl class="info-list-ss">
                                        <dt><i class="fas fa-barcode"></i> Mã Tracking (REF Code)</dt>
                                        <dd>1ZY5W1730491854782</dd>
                                        <dt><i class="fas fa-map-marker-alt"></i> Từ</dt>
                                        <dd>HO CHI MINH, VN</dd>
                                        <dt><i class="fas fa-map-pin"></i> Tới</dt>
                                        <dd>United States</dd>
                                        <dt><i class="fas fa-shipping-fast"></i> Dịch vụ</dt>
                                        <dd>MTE-US</dd>
                                        <dt><i class="far fa-calendar-alt"></i> Ngày gửi</dt>
                                        <dd>15-08-2024</dd>
                                        <dt><i class="far fa-calendar-check"></i> Ngày xuất</dt>
                                        <dd>18-08-2024</dd>
                                    </dl>
                                    <h3 class="info-group-title-ss"><i class="fa-solid fa-box"></i> Chi tiết gói hàng</h3>
                                    <dl class="info-list-ss">
                                        <dt><i class="fas fa-boxes-stacked"></i> Loại kiện</dt>
                                        <dd>Hàng hóa</dd>
                                        <dt><i class="fas fa-calculator"></i> Tổng số kiện</dt>
                                        <dd>2</dd>
                                    </dl>
                                </div>
                            </section>
                        </div>

                        <div class="column-right-ss">
                            <section class="card history-card-ss">
                                <header class="card-header history-header-ss">
                                    <h2 class="card-title"><i class="fas fa-history"></i> Lịch sử & Cập nhật</h2>
                                    <button type="button" class="icon-button section-toggle-btn" title="Thu gọn/Mở rộng"><i class="fas fa-chevron-up"></i></button>
                                </header>
                                <div class="card-body history-body-ss">
                                    <div class="add-history-toggle-ss" style="cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                        <i class="fas fa-plus-circle" style="color:#6366f1;font-size:1.1em;"></i>
                                        <span class="section-subtitle" style="margin:0;font-weight:600;font-size:1em;user-select:none;">Thêm mục lịch sử</span>
                                    </div>
                                    <form class="add-history-form-ss card-section">
                                        <div class="add-history-grid-ss">
                                            <label for="history_time_ss">Thời gian:</label>
                                            <input type="datetime-local" id="history_time_ss" aria-label="Thời gian lịch sử">
                                            <label for="history_location_ss">Địa chỉ:</label>
                                            <input type="text" id="history_location_ss" placeholder="VD: HONGKONG" aria-label="Địa chỉ lịch sử">
                                            <label for="history_description_ss">Nội dung trạng thái:</label>
                                            <input type="text" id="history_description_ss" placeholder="VD: Hàng cập bến..." aria-label="Nội dung trạng thái">
                                        </div>
                                        <div class="form-actions">
                                            <button type="submit" class="button confirm btn-add-history-ss" title="Thêm"><i class="fa-solid fa-plus"></i> Thêm</button>
                                            <button type="reset" class="button warning btn-reset-history-ss" title="Làm mới"><i class="fa-solid fa-arrows-rotate"></i> Làm mới</button>
                                        </div>
                                    </form>

                                    <div class="timeline-section-ss card-section">
                                        <div class="timeline-header-ss" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                            <h3 class="section-subtitle" style="margin-bottom: 0;"><i class="fas fa-list-ul"></i> Chi tiết lịch sử</h3>
                                            <button type="button" class="timeline-toggle-btn-ss" title="Thu gọn/Mở rộng" style="background: none; border: none; color: #6366f1; font-size: 1.3em; cursor: pointer; padding: 4px 10px; border-radius: 6px;"><i class="fas fa-chevron-up"></i></button>
                                        </div>
                                        <ul class="timeline-ss">
                                            <li class="timeline-item-ss completed">
                                                <span class="timeline-icon-ss"><i class="fas fa-check"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info"><strong>Thứ sáu</strong>, 25/08/2024 - 1:04 PM</div>
                                                    <div class="description"> Giao hàng thành công <br> <span class="location">Điểm đến: NEW YORK CITY - United States</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info"><strong>Thứ năm</strong>, 24/08/2024 - 11:04 PM</div>
                                                    <div class="description"> Hàng cập bến sân bay New York <br> <span class="location">NEWYORK, UNITED STATES</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info">09:04 AM</div>
                                                    <div class="description"> Hàng cập bến Hong Kong đến New York <br> <span class="location">HONGKONG - NEWYORK</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info">09:04 AM</div>
                                                    <div class="description"> Hàng đang bay từ kho DHL đến New York <br> <span class="location">HCM - HONGKONG - NEWYORK</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info"><strong>Thứ ba</strong>, 22/08/2024 - 1:24 AM</div>
                                                    <div class="description"> Hàng đã được giữ tại Hãng <br> <span class="location">TÂN SƠN NHẤT, HCM</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info">05:04 PM</div>
                                                    <div class="description"> Hàng đã được cân lại tại Hàng <br> <span class="location">TÂN SƠN NHẤT, HCM</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss"><i class="fa-solid fa-location-arrow"></i></span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info"><strong>Thứ hai</strong>, 16/08/2024 - 5:24 AM</div>
                                                    <div class="description"> Hàng đã xuất kho <br> <span class="location">TÂN PHÚ, HCM</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                            <li class="timeline-item-ss pending">
                                                <span class="timeline-icon-ss error-icon">!</span>
                                                <div class="timeline-content-ss">
                                                    <div class="time-info"><strong>Chủ Nhật</strong>, 15/08/2024 - 1:24 AM</div>
                                                    <div class="description"> Đơn hàng được tạo <br> <span class="location">Quận 7, HCM</span> </div>
                                                    <button class="timeline-delete-btn-ss" title="Xóa"><i class="fas fa-trash-can"></i></button>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <footer class="site-footer"> Miền Tây Express © <span id="current-year"></span>. All rights reserved. Design by Nina Co.,Ltd </footer>
    </main>

    <div class="announcement-overlay" id="announcement-overlay">
        <div class="announcement-box" id="announcement-box">
            <div class="announcement-header">
                <h3 id="announcement-title">Tiêu đề thông báo</h3>
                <button class="announcement-close-btn" id="announcement-close-btn" title="Đóng thông báo">×</button>
            </div>
            <div class="announcement-body" id="announcement-body">
                Nội dung chi tiết của thông báo sẽ được hiển thị ở đây.
            </div>
            <div class="announcement-footer">
                <span id="announcement-timestamp">Thời gian</span>
            </div>
        </div>
    </div>

    <script>
        const body = document.body;
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const mobileSidebarToggleBtn = document.getElementById('mobile-sidebar-toggle');
        const desktopSidebarToggleBtn = document.querySelector('.sidebar-toggle-desktop');
        const currentDateSpan = document.getElementById('current-date');
        const currentTimeSpan = document.getElementById('current-time');
        const currentYearSpan = document.getElementById('current-year');
        const fullscreenBtn = document.getElementById('fullscreen-btn');

        const manageBodyScroll = () => {
            const isSidebarOpen = body.classList.contains('sidebar-mobile-open');
            const isAnyModalVisible = document.querySelector('.confirmation-modal.visible, .announcement-overlay.visible');
            if (isSidebarOpen || isAnyModalVisible) {
                 body.classList.add('overflow-hidden');
            } else {
                 body.classList.remove('overflow-hidden');
            }
        };

        function toggleSidebarMobileOrDesktop() {
            if (window.innerWidth > 768) {
                body.classList.toggle('sidebar-collapsed');
            } else {
                body.classList.toggle('sidebar-mobile-open');
                const isOpen = body.classList.contains('sidebar-mobile-open');
                if (mobileSidebarToggleBtn) mobileSidebarToggleBtn.setAttribute('aria-expanded', String(isOpen));
            }
            manageBodyScroll();
        }

        function toggleSidebarDesktop() {
            body.classList.toggle('sidebar-collapsed');
            const isCollapsed = body.classList.contains('sidebar-collapsed');
            if (desktopSidebarToggleBtn) {
                desktopSidebarToggleBtn.title = isCollapsed ? "Phóng Sidebar" : "Thu Sidebar";
            }
            if (isCollapsed) {
                document.querySelectorAll('.menu-items .submenu.active').forEach(submenu => {
                    submenu.classList.remove('active');
                    const parentLink = submenu.previousElementSibling;
                    if (parentLink?.classList.contains('submenu-parent')) {
                        parentLink.classList.remove('active');
                        parentLink.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(0deg)');
                    }
                });
            } else {
                initializeActiveSubmenu();
            }
        }

        function toggleSubmenu(event) {
           event.preventDefault();
           if (body.classList.contains('sidebar-collapsed') && window.innerWidth > 768) return;
           const parentLink = event.currentTarget;
           const submenuWrapper = parentLink.nextElementSibling;
           const arrow = parentLink.querySelector('.submenu-arrow');
           if (!submenuWrapper?.classList.contains('submenu')) return;
           const parentList = parentLink.closest('ul');
           if (parentList) {
               parentList.querySelectorAll(':scope > li > .submenu-parent.active').forEach(activeParent => {
                   if (activeParent !== parentLink) {
                       activeParent.classList.remove('active');
                       activeParent.nextElementSibling?.classList.remove('active');
                       activeParent.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(0deg)');
                   }
               });
           }
           const isActive = submenuWrapper.classList.toggle('active');
           parentLink.classList.toggle('active', isActive);
           if (arrow) arrow.style.setProperty('transform', isActive ? 'rotate(180deg)' : 'rotate(0deg)');
        }

        function initializeActiveSubmenu() {
            const activeSubmenuLink = document.querySelector('.sidebar .submenu a.active');
            if (activeSubmenuLink) {
                const submenuDiv = activeSubmenuLink.closest('.submenu');
                const parentLink = submenuDiv?.previousElementSibling;
                if(submenuDiv && parentLink?.classList.contains('submenu-parent')) {
                    if (!(body.classList.contains('sidebar-collapsed') && window.innerWidth > 768)) {
                        submenuDiv.classList.add('active');
                        parentLink.classList.add('active');
                        parentLink.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(180deg)');
                    } else {
                        submenuDiv.classList.remove('active');
                        parentLink.classList.remove('active');
                        parentLink.querySelector('.submenu-arrow')?.style.setProperty('transform', 'rotate(0deg)');
                    }
                }
            }
        }

        function updateDateTime() {
            const now = new Date();
            const optionsDate = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
            const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            if (currentDateSpan) currentDateSpan.textContent = now.toLocaleDateString('en-GB', optionsDate).replace(/,/g, '');
            if (currentTimeSpan) currentTimeSpan.textContent = now.toLocaleTimeString('en-US', optionsTime);
            if (currentYearSpan) currentYearSpan.textContent = now.getFullYear();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => console.error(`Fullscreen error: ${err.message}`));
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }

        function handleFullscreenChange() {
             const isFullscreen = !!document.fullscreenElement;
             const icon = fullscreenBtn?.querySelector('i');
             if(icon){
                 icon.classList.toggle('fa-expand', !isFullscreen);
                 icon.classList.toggle('fa-compress', isFullscreen);
             }
              if(fullscreenBtn) {
                  fullscreenBtn.setAttribute('title', isFullscreen ? 'Exit Fullscreen' : 'Fullscreen');
              }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeActiveSubmenu();
            updateDateTime();
            setInterval(updateDateTime, 1000);

            if (mobileSidebarToggleBtn) mobileSidebarToggleBtn.addEventListener('click', toggleSidebarMobileOrDesktop);
                else console.error("Mobile toggle button not found");
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', toggleSidebarMobileOrDesktop);
                else console.error("Sidebar overlay not found");
            if (desktopSidebarToggleBtn) desktopSidebarToggleBtn.addEventListener('click', toggleSidebarDesktop);
            document.querySelectorAll('.menu-items .submenu-parent').forEach(link => { link.addEventListener('click', toggleSubmenu); });
            if (fullscreenBtn) fullscreenBtn.addEventListener('click', toggleFullscreen);
            document.addEventListener('fullscreenchange', handleFullscreenChange);

            function toggleCardSection(buttonElement) {
                const card = buttonElement.closest('.card');
                const icon = buttonElement.querySelector('i');
                if (card && icon) {
                    const isCollapsed = card.classList.toggle('collapsed');
                    icon.classList.toggle('fa-chevron-down', isCollapsed);
                    icon.classList.toggle('fa-chevron-up', !isCollapsed);
                }
            }

            document.querySelectorAll('.card-header .section-toggle-btn').forEach(button => {
                button.addEventListener('click', () => toggleCardSection(button));
                const card = button.closest('.card');
                const icon = button.querySelector('i');
                if(card && icon){
                    const isCollapsed = card.classList.contains('collapsed');
                    icon.classList.toggle('fa-chevron-down', isCollapsed);
                    icon.classList.toggle('fa-chevron-up', !isCollapsed);
                }
            });

            function updateScreenshotProgressBar(activeIndex) {
                const steps = document.querySelectorAll('.progress-step-ss');
                const totalSteps = steps.length;
                if (!steps || totalSteps === 0) return;
                activeIndex = Math.max(0, Math.min(activeIndex, totalSteps - 1));
                steps.forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index < activeIndex) { step.classList.add('completed'); }
                    else if (index === activeIndex) { step.classList.add('active'); }
                });
                 const progressPercent = totalSteps <= 1 ? 100 : (activeIndex / (totalSteps - 1)) * 100;
                 document.documentElement.style.setProperty('--straking-progress-width-ss', progressPercent + '%');
            }

            const statusUpdateForm = document.getElementById('tracking-status-form');
            const mainUpdateButton = statusUpdateForm?.querySelector('.btn-update-ss');
            const mainCancelButton = statusUpdateForm?.querySelector('.btn-cancel-ss');
            const mainStatusSelect = document.getElementById('tracking_status_select');

            if(mainUpdateButton && mainStatusSelect){
                mainUpdateButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const selectedValue = mainStatusSelect.value;
                    const selectedText = mainStatusSelect.options[mainStatusSelect.selectedIndex].text;
                    alert(`Cập nhật trạng thái thành: ${selectedText} (Demo)`);
                    let newIndex = 0;
                     switch(selectedValue) {
                         case 'received': newIndex = 0; break;
                         case 'warehouse': newIndex = 1; break;
                         case 'shipping': newIndex = 2; break;
                         case 'delivered': newIndex = 3; break;
                         default: newIndex = 0;
                     }
                     updateScreenshotProgressBar(newIndex);
                });
            }
            if(mainCancelButton){ mainCancelButton.addEventListener('click', () => window.history.back()); }

            const addHistoryToggle = document.querySelector('.add-history-toggle-ss');
            const addHistoryForm = document.querySelector('.add-history-form-ss');
            if(addHistoryForm) addHistoryForm.style.display = 'none';
            if(addHistoryToggle && addHistoryForm) {
                addHistoryToggle.addEventListener('click', () => {
                    const isHidden = addHistoryForm.style.display === 'none' || addHistoryForm.style.display === '';
                    addHistoryForm.style.display = isHidden ? 'block' : 'none';
                });
            }

            const handleDeleteHistory = (e) => {
                e.stopPropagation();
                if(confirm('Bạn có chắc muốn xóa mục lịch sử này?')){
                    e.target.closest(".timeline-item-ss")?.remove();
                    alert('Đã xóa mục lịch sử (Demo)!');
                }
            };
            document.querySelectorAll('.timeline-delete-btn-ss').forEach(button => { button.addEventListener('click', handleDeleteHistory); });

            updateScreenshotProgressBar(2);

            const timelineSection = document.querySelector('.timeline-section-ss');
            const timelineList = timelineSection?.querySelector('.timeline-ss');
            const timelineToggleBtn = timelineSection?.querySelector('.timeline-toggle-btn-ss');
            if(timelineToggleBtn && timelineList) {
                timelineList.classList.add('collapsed');
                timelineList.style.display = 'none';
                const icon = timelineToggleBtn.querySelector('i');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                timelineToggleBtn.addEventListener('click', () => {
                    const isCollapsed = timelineList.classList.toggle('collapsed');
                    const icon = timelineToggleBtn.querySelector('i');
                    if(isCollapsed) {
                        timelineList.style.display = 'none';
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    } else {
                        timelineList.style.display = '';
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    }
                });
            }

        });

        document.addEventListener('DOMContentLoaded', () => {
            const notificationBody = document.body;
            const notificationButton = document.getElementById('notification-button');
            const notificationDropdown = document.getElementById('notification-dropdown');
            const notificationList = document.getElementById('notification-list');
            const announcementOverlay = document.getElementById('announcement-overlay');
            const announcementBox = document.getElementById('announcement-box');
            const announcementCloseBtn = document.getElementById('announcement-close-btn');
            const announcementTitle = document.getElementById('announcement-title');
            const announcementBodyEl = document.getElementById('announcement-body');
            const announcementTimestamp = document.getElementById('announcement-timestamp');

            const manageNotificationBodyScroll = () => {
                const isAnnounceVisible = announcementOverlay && announcementOverlay.classList.contains('visible');
                const isAnyOtherModalVisible = false;

                if (isAnnounceVisible || isAnyOtherModalVisible) {
                    notificationBody.classList.add('overflow-hidden');
                } else {
                    if (!isAnyOtherModalVisible) {
                         notificationBody.classList.remove('overflow-hidden');
                    }
                }
            };

            function toggleNotificationDropdown() {
                if (notificationDropdown) {
                    notificationDropdown.classList.toggle('visible');
                }
            }

            function closeNotificationDropdown() {
                 if (notificationDropdown) {
                    notificationDropdown.classList.remove('visible');
                 }
            }

            function showAnnouncement() {
                if (announcementOverlay) {
                    announcementOverlay.classList.add('visible');
                    manageNotificationBodyScroll();
                }
            }

            function closeAnnouncement() {
                if (announcementOverlay) {
                    announcementOverlay.classList.remove('visible');
                    manageNotificationBodyScroll();
                }
            }

            if (announcementOverlay && announcementOverlay.classList.contains('visible')) {
                closeAnnouncement();
            }

            if (notificationButton) {
                notificationButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    toggleNotificationDropdown();
                });
            }

            if (notificationList) {
                notificationList.addEventListener('click', (event) => {
                    const clickedItem = event.target.closest('.notification-item');
                    if (clickedItem && announcementTitle && announcementBodyEl && announcementTimestamp) {
                        const title = clickedItem.dataset.title || 'Thông báo';
                        const bodyText = clickedItem.dataset.body || 'Không có nội dung.';
                        const timestamp = clickedItem.dataset.timestamp || '';

                        announcementTitle.textContent = title;
                        announcementBodyEl.innerHTML = '';
                        bodyText.split('||').forEach(paragraphText => {
                            if(paragraphText.trim()) {
                                const p = document.createElement('p');
                                p.textContent = paragraphText.trim();
                                announcementBodyEl.appendChild(p);
                            }
                        });
                        announcementTimestamp.textContent = timestamp;
                        showAnnouncement();
                        closeNotificationDropdown();
                    }
                });
            }

            document.addEventListener('click', (event) => {
                if (notificationDropdown && notificationDropdown.classList.contains('visible')) {
                    if (!notificationDropdown.contains(event.target) && event.target !== notificationButton && !notificationButton.contains(event.target)) {
                        closeNotificationDropdown();
                    }
                }
            });

            if (announcementCloseBtn) {
                announcementCloseBtn.addEventListener('click', closeAnnouncement);
            }

            if (announcementOverlay) {
                announcementOverlay.addEventListener('click', (event) => {
                    if (event.target === announcementOverlay) {
                        closeAnnouncement();
                    }
                });
            }

            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (announcementOverlay && announcementOverlay.classList.contains('visible')) {
                        closeAnnouncement();
                    } else if (notificationDropdown && notificationDropdown.classList.contains('visible')) {
                        closeNotificationDropdown();
                    }
                }
            });
        });

        // --- Dropdown user ---
        const userToggle = document.getElementById('user-dropdown-toggle');
        const userDropdown = document.getElementById('user-dropdown');
        if(userToggle && userDropdown){
            userToggle.addEventListener('click', function(e){
                e.stopPropagation();
                userDropdown.classList.toggle('show');
            });
            document.addEventListener('click', function(e){
                if(!userDropdown.contains(e.target) && e.target !== userToggle){
                    userDropdown.classList.remove('show');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            function renderUserDropdown() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const userToggle = document.getElementById('user-dropdown-toggle');
                const userDropdown = document.getElementById('user-dropdown');
                if (!userToggle || !userDropdown) return;
                if (!isLoggedIn) {
                    // Chưa đăng nhập: chỉ hiện icon user và 1 mục Đăng nhập
                    userToggle.innerHTML = '<i class="fa-regular fa-circle-user user-icon" id="user-icon" style="color: #64748b; font-size: 1.6em;"></i>';
                    userDropdown.innerHTML = '<a href="#" class="user-dropdown-item" id="login-menu-item"><i class="fa-solid fa-right-to-bracket"></i> Đăng nhập</a>';
                    document.getElementById('username-display')?.classList.add('d-none');
                } else {
                    // Đã đăng nhập: hiện đủ menu
                    userToggle.innerHTML = '<i class="fa-regular fa-circle-user user-icon" id="user-icon" style="color: #64748b; font-size: 1.6em;"></i>';
                    userDropdown.innerHTML = `
                        <div class="user-info">
                            <div class="user-avatar"><i class="fa-regular fa-circle-user"></i></div>
                            <div class="user-details"><h4>Phạm Hoàng Đình</h4><span class="user-role">Quản trị viên</span></div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="user-dropdown-item"><i class="fa-regular fa-user"></i> Thông tin cá nhân</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-gear"></i> Cài đặt tài khoản</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-bell"></i> Thông báo</a>
                        <a href="#" class="user-dropdown-item"><i class="fa-solid fa-shield-halved"></i> Bảo mật</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="user-dropdown-item" id="logout-menu-item"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a>
                    `;
                    document.getElementById('username-display')?.classList.remove('d-none');
                }
                // Gắn sự kiện cho menu
                setTimeout(() => {
                    const loginItem = document.getElementById('login-menu-item');
                    if (loginItem) loginItem.onclick = function(e) { e.preventDefault(); window.location.href = 'login.html'; };
                    const logoutItem = document.getElementById('logout-menu-item');
                    if (logoutItem) logoutItem.onclick = function(e) { e.preventDefault(); localStorage.removeItem('isLoggedIn'); window.location.reload(); };
                }, 100);
            }
            renderUserDropdown();
            window.addEventListener('storage', renderUserDropdown);
        });
    </script>

</body>
</html>