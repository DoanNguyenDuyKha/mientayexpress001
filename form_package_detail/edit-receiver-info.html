<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .edit-receiver-info-form {
            --form-primary-color: #FFD600;
            --form-primary-hover: #FFB300;
            --form-secondary-color: #181818;
            --form-success-color: #FFD600;
            --form-danger-color: #EF4444;
            --form-light-gray: #f8f9fa;
            --form-border-color: rgba(255, 214, 0, 0.2);
            --form-border-color-light: #eee;
            --form-text-color: #181818;
            --form-text-muted: #64748b;
            --form-required-color: #EF4444;
            --form-border-radius: 12px;
            --form-spacing-unit: 10px;
            --form-control-padding-y: 10px;
            --form-control-padding-x: 16px;
            --form-font-size-base: 12px;
            --form-font-size-sm: 10px;
            --form-label-width: 130px;
            --form-font-family: 'Inter', system-ui, -apple-system, sans-serif;
            --form-shadow-lg: 0 10px 15px rgba(0,0,0,0.10);
            --form-transition: all 0.3s ease;
        }

        .edit-receiver-info-form *,
        .edit-receiver-info-form *::before,
        .edit-receiver-info-form *::after {
            box-sizing: border-box !important;
            margin: 0 !important;
            padding: 0 !important;
            border: 0 solid transparent !important;
            background: transparent !important;
            font-size: 100% !important;
            font: inherit !important;
            vertical-align: baseline !important;
            color: inherit !important;
            line-height: inherit !important;
        }

        .edit-receiver-info-form {
            font-family: var(--form-font-family) !important;
            font-size: var(--form-font-size-base) !important;
            color: var(--form-text-color) !important;
            background-color: #fff !important;
            border-radius: var(--form-border-radius) !important;
            overflow: hidden !important;
            display: flex !important;
            flex-direction: column !important;
            line-height: 1.5 !important;
            border: 1.5px solid var(--form-border-color) !important;
            box-shadow: var(--form-shadow-lg) !important;
            width: 100% !important;
            animation: fadeIn 0.4s ease-out !important;
        }

        .edit-receiver-info-form div, .edit-receiver-info-form span, .edit-receiver-info-form label,
        .edit-receiver-info-form h2, .edit-receiver-info-form p, .edit-receiver-info-form select,
        .edit-receiver-info-form input, .edit-receiver-info-form button, .edit-receiver-info-form textarea {
            font-family: var(--form-font-family) !important;
            line-height: 1.5 !important;
            background-color: transparent;
            border: none;
            border-radius: 0;
            display: block;
        }
         .edit-receiver-info-form span, .edit-receiver-info-form i {
              display: inline-block;
         }
          .edit-receiver-info-form input[type="checkbox"],
          .edit-receiver-info-form input[type="radio"] {
              display: inline-block;
              width: auto !important;
              height: auto !important;
          }
         .edit-receiver-info-form label {
             display: inline-block;
             margin-bottom: 0;
             padding: 0;
         }


        .edit-receiver-info-form .form-header {
            background: linear-gradient(90deg, #FFD700 0%, #FFF8DC 100%) !important;
            color: var(--form-primary-color) !important;
            padding: calc(var(--form-spacing-unit) * 2) calc(var(--form-spacing-unit) * 2.5) !important;
            flex-shrink: 0 !important;
            border-bottom: 1.5px solid var(--form-primary-color) !important;
            display: flex !important;
            align-items: center !important;
            border-top-left-radius: var(--form-border-radius) !important;
            border-top-right-radius: var(--form-border-radius) !important;
        }
        .edit-receiver-info-form .form-header h2 {
            margin: 0 !important; padding: 0 !important;
            font-size: 1.18rem !important;
            font-weight: 700 !important;
            line-height: 1.4 !important;
            color: black !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
        }
        .edit-receiver-info-form .form-header h2::before {
            content: '\f007';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 1.4em;
            color: var(--form-primary-color);
        }

        .edit-receiver-info-form #formReceiverInfoModal {
             display: flex !important; flex-direction: column !important;
             flex-grow: 1 !important; overflow: hidden !important;
             margin: 0 !important; padding: 0 !important; border: none !important; background: transparent !important;
         }

        .edit-receiver-info-form .form-body {
            padding: calc(var(--form-spacing-unit) * 2) calc(var(--form-spacing-unit) * 2.5) !important;
            flex-grow: 1 !important; overflow-y: auto !important;
            display: grid !important;
            grid-template-columns: var(--form-label-width) 1fr var(--form-label-width) 1fr !important;
            gap: calc(var(--form-spacing-unit) * 1.8) calc(var(--form-spacing-unit) * 2) !important;
            align-items: start !important;
            background-color: #fff !important; border: none !important;
        }

         .edit-receiver-info-form .grid-label {
             grid-column: auto / span 1 !important;
             font-weight: 600 !important;
             color: var(--form-secondary-color) !important;
             text-align: right !important;
             padding-right: var(--form-spacing-unit) !important;
             padding-top: var(--form-control-padding-y) !important;
             white-space: nowrap !important;
             font-size: var(--form-font-size-sm) !important;
             line-height: 1.5 !important;
             border: none !important; background: transparent !important;
             position: relative !important;
         }
          .edit-receiver-info-form .grid-label.required::after {
               content: '*' !important;
               color: var(--form-required-color) !important;
               position: absolute !important;
               right: calc(var(--form-spacing-unit) - 5px) !important;
               top: var(--form-control-padding-y) !important;
               font-weight: bold !important;
               font-size: 1.1em !important;
           }


        .edit-receiver-info-form .grid-control {
             grid-column: auto / span 1 !important;
             display: flex !important;
             flex-direction: column !important;
             align-items: stretch !important;
             gap: calc(var(--form-spacing-unit) * 0.5) !important;
             padding: 0 !important; margin: 0 !important; border: none !important; background: transparent !important;
         }
         .edit-receiver-info-form .grid-control-span3 {
              grid-column: auto / span 3 !important;
         }
          .edit-receiver-info-form .grid-control-full {
              grid-column: 1 / -1 !important;
              margin-top: calc(var(--form-spacing-unit) * -1) !important;
         }
         .edit-receiver-info-form .grid-label-full {
             grid-column: 1 / -1 !important;
             text-align: left !important;
             padding-right: 0 !important;
             padding-top: 0 !important;
             margin-bottom: calc(var(--form-spacing-unit) * 0.5) !important;
         }
          .edit-receiver-info-form .grid-label-full.required::after {
              left: auto !important;
              right: auto !important;
              position: relative !important;
              margin-left: 3px !important;
              top: 0 !important;
          }

          .edit-receiver-info-form .grid-label-col3 {
             grid-column: 3 / 4 !important;
         }
          .edit-receiver-info-form .grid-control-col4 {
             grid-column: 4 / 5 !important;
         }


        .edit-receiver-info-form .control-item {
            min-height: calc(1.5em + var(--form-control-padding-y) * 2 + 2px) !important;
            padding: var(--form-control-padding-y) var(--form-control-padding-x) !important;
            font-size: var(--form-font-size-base) !important;
            line-height: 1.5 !important;
            color: var(--form-text-color) !important;
            background-color: #fff !important;
            border: 1.5px solid #ffd600 !important;
            border-radius: var(--form-border-radius) !important;
            transition: var(--form-transition) !important;
            width: 100% !important;
            box-shadow: none !important;
            display: block !important;
            margin: 0 !important;
        }
        .edit-receiver-info-form select.control-item {
             appearance: none !important; -webkit-appearance: none !important; -moz-appearance: none !important;
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23FFD600' stroke='%23FFD600' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e") !important;
             background-repeat: no-repeat !important;
             background-position: right var(--form-control-padding-x) center !important;
             background-size: 16px 12px !important;
             padding-right: calc(var(--form-control-padding-x) * 2.5 + 16px) !important;
        }
        .edit-receiver-info-form textarea.control-item {
             resize: vertical !important;
             min-height: 60px !important;
        }

        .edit-receiver-info-form .control-item:focus {
            border-color: var(--form-primary-color) !important;
            outline: 0 !important;
            box-shadow: 0 0 0 3px rgba(255, 214, 0, 0.15) !important;
        }

        .edit-receiver-info-form .phone-group {
            display: flex !important;
            align-items: center !important;
            gap: calc(var(--form-spacing-unit) * 0.75) !important;
            width: 100% !important;
            border: 1.5px solid var(--form-border-color) !important;
            border-radius: var(--form-border-radius) !important;
            padding: 0 !important;
            background-color: #fff !important;
        }
         .edit-receiver-info-form .phone-group:focus-within {
             border-color: var(--form-primary-color) !important;
             box-shadow: 0 0 0 3px rgba(255, 214, 0, 0.15) !important;
         }

        .edit-receiver-info-form .phone-part {
            display: flex !important;
            align-items: center !important;
            flex-grow: 1 !important;
            position: relative !important;
        }
         .edit-receiver-info-form .phone-part + .phone-part::before {
              content: '' !important;
              display: block !important;
              width: 1px !important;
              height: calc(100% - var(--form-control-padding-y) * 2) !important;
              background-color: var(--form-border-color) !important;
              position: absolute !important;
              left: calc(var(--form-spacing-unit) * -0.375) !important;
              top: var(--form-control-padding-y) !important;
         }


        .edit-receiver-info-form .country-code {
            padding: var(--form-control-padding-y) var(--form-control-padding-x) !important;
            font-weight: 600 !important;
            color: var(--form-primary-color) !important;
            background-color: #FFF9C4 !important;
            border-right: 1.5px solid var(--form-primary-color) !important;
            flex-shrink: 0 !important;
            align-self: stretch !important;
            display: flex !important; align-items: center !important;
        }
         .edit-receiver-info-form .phone-part:first-child .country-code {
             border-top-left-radius: var(--form-border-radius) !important;
             border-bottom-left-radius: var(--form-border-radius) !important;
         }

        .edit-receiver-info-form .phone-input {
             flex-grow: 1 !important;
             border: none !important;
             box-shadow: none !important;
             border-radius: 0 !important;
             padding: var(--form-control-padding-y) var(--form-control-padding-x) !important;
             background-color: transparent !important;
             min-height: calc(1.5em + var(--form-control-padding-y) * 2) !important;
             height: auto !important;
        }
         .edit-receiver-info-form .phone-input:focus {
             outline: none !important; box-shadow: none !important;
         }

        .edit-receiver-info-form .phone-count {
             padding: var(--form-control-padding-y) var(--form-control-padding-x) !important;
             font-size: var(--form-font-size-sm) !important;
             color: var(--form-primary-color) !important;
             font-weight: 600 !important;
             flex-shrink: 0 !important;
             background-color: #FFF9C4 !important;
             border-top-right-radius: var(--form-border-radius) !important;
             border-bottom-right-radius: var(--form-border-radius) !important;
         }

        .edit-receiver-info-form .address-note {
             font-size: var(--form-font-size-sm) !important;
             color: var(--form-required-color) !important;
             margin-top: calc(var(--form-spacing-unit) * 0.5) !important;
             display: block !important;
             padding: 0 !important; border: none !important; background: transparent !important;
             line-height: 1.4 !important;
         }

        .edit-receiver-info-form .form-actions {
            padding: calc(var(--form-spacing-unit) * 2) calc(var(--form-spacing-unit) * 2.5) !important;
            background: white !important;
            border-top: 1.5px solid var(--form-primary-color) !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            gap: var(--form-spacing-unit) !important;
            flex-shrink: 0 !important;
            margin: 0 !important;
            border-bottom-left-radius: var(--form-border-radius) !important;
            border-bottom-right-radius: var(--form-border-radius) !important;
        }

        .edit-receiver-info-form .save-info-checkbox {
             display: inline-flex !important;
             align-items: center !important;
             gap: calc(var(--form-spacing-unit) * 0.8) !important;
             cursor: pointer !important;
             font-size: var(--form-font-size-sm) !important;
             color: var(--form-text-muted) !important;
             padding: 0 !important; margin: 0 !important; border: none !important; background: transparent !important;
         }
         .edit-receiver-info-form .save-info-checkbox input[type="checkbox"] {
             width: 18px !important; height: 18px !important;
             margin: 0 !important; padding: 0 !important;
             border: 1.5px solid var(--form-primary-color) !important;
             border-radius: 5px !important;
             cursor: pointer !important;
             appearance: none !important; -webkit-appearance: none !important;
             position: relative !important;
             vertical-align: middle !important;
             transition: background-color 0.15s, border-color 0.15s !important;
             background-color: #fff !important;
         }
          .edit-receiver-info-form .save-info-checkbox input[type="checkbox"]::before {
             content: '\f00c' !important; font-family: "Font Awesome 6 Free" !important; font-weight: 900 !important;
             font-size: 9px !important; color: white !important; display: block !important;
             position: absolute !important; top: 50% !important; left: 50% !important;
             transform: translate(-50%, -50%) scale(0) !important;
             transition: transform 0.15s ease-in-out !important;
         }
         .edit-receiver-info-form .save-info-checkbox input[type="checkbox"]:checked {
             border-color: var(--form-primary-color) !important;
             background-color: var(--form-primary-color) !important;
         }
          .edit-receiver-info-form .save-info-checkbox input[type="checkbox"]:checked::before {
              transform: translate(-50%, -50%) scale(1.1) !important;
          }
         .edit-receiver-info-form .save-info-checkbox span {
             display: inline !important;
             padding: 0 !important; margin: 0 !important; border: none !important; background: transparent !important; font: inherit !important; color: inherit !important;
         }


        .edit-receiver-info-form .action-buttons {
            display: flex !important;
            gap: var(--form-spacing-unit) !important;
            padding: 0 !important; margin: 0 !important; border: none !important; background: transparent !important;
        }

        .edit-receiver-info-form .form-btn {
            display: inline-flex !important; align-items: center !important; justify-content: center !important;
            gap: calc(var(--form-spacing-unit) * 0.8) !important;
            padding: calc(var(--form-control-padding-y) + 2px) calc(var(--form-control-padding-x) * 1.5) !important;
            font-size: var(--form-font-size-base) !important; font-weight: 600 !important;
            border-radius: var(--form-border-radius) !important; border: 1.5px solid transparent !important;
            cursor: pointer !important; transition: var(--form-transition) !important;
            line-height: 1.4 !important; white-space: nowrap !important; min-width: 100px !important;
            margin: 0 !important;
            color: var(--form-text-color) !important;
        }
        .edit-receiver-info-form .form-btn-cancel {
            background-color: transparent !important;
            color: var(--form-primary-color) !important;
            border-color: var(--form-primary-color) !important;
        }
        .edit-receiver-info-form .form-btn-cancel:hover {
            background-color: var(--form-primary-color) !important;
            color: var(--form-secondary-color) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(255, 214, 0, 0.2) !important;
        }
        .edit-receiver-info-form .form-btn-confirm {
            background: linear-gradient(90deg, var(--form-primary-color) 0%, var(--form-primary-hover) 100%) !important;
            color: var(--form-secondary-color) !important;
            border: none !important;
            box-shadow: 0 2px 8px rgba(255, 214, 0, 0.15) !important;
        }
        .edit-receiver-info-form .form-btn-confirm:hover {
            background: linear-gradient(90deg, var(--form-primary-hover) 0%, var(--form-primary-color) 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(255, 214, 0, 0.2) !important;
        }
        .edit-receiver-info-form .form-btn:focus-visible {
            outline: 1.5px solid var(--form-primary-color) !important;
            outline-offset: 1px !important;
            box-shadow: none !important;
        }
        .edit-receiver-info-form .form-btn:active {
            transform: scale(0.98) !important;
        }

        @media (max-width: 768px) {
             .edit-receiver-info-form .form-body {
                 grid-template-columns: var(--form-label-width) 1fr !important;
                 gap: calc(var(--form-spacing-unit) * 1.5) calc(var(--form-spacing-unit) * 1) !important;
             }
              .edit-receiver-info-form .grid-label-col3,
              .edit-receiver-info-form .grid-control-col4 {
                  grid-column: auto / span 1 !important;
              }
               .edit-receiver-info-form .group-country-postcode,
               .edit-receiver-info-form .group-city-state {
                    grid-column: 1 / -1 !important;
                    display: grid !important;
                    grid-template-columns: var(--form-label-width) 1fr !important;
                    gap: 0 calc(var(--form-spacing-unit) * 1) !important;
                    align-items: center !important;
               }
                .edit-receiver-info-form .group-country-postcode > .grid-control,
                .edit-receiver-info-form .group-city-state > .grid-control {
                     grid-column: 2 / 3 !important;
                }
                 .edit-receiver-info-form .group-country-postcode > .grid-label:nth-of-type(2),
                 .edit-receiver-info-form .group-city-state > .grid-label:nth-of-type(2) {
                     grid-column: 1 / 2 !important;
                     grid-row: 2 / 3 !important;
                      margin-top: calc(var(--form-spacing-unit) * 1) !important;
                 }
                 .edit-receiver-info-form .group-country-postcode > .grid-control:nth-of-type(2),
                 .edit-receiver-info-form .group-city-state > .grid-control:nth-of-type(2) {
                     grid-column: 2 / 3 !important;
                     grid-row: 2 / 3 !important;
                      margin-top: calc(var(--form-spacing-unit) * 1) !important;
                 }

              .edit-receiver-info-form .grid-label-full { grid-column: 1 / -1 !important; text-align: left !important; padding-right: 0 !important; }
              .edit-receiver-info-form .grid-control-full { grid-column: 1 / -1 !important; }
        }

        @media (max-width: 500px) {
             .edit-receiver-info-form .form-body {
                 grid-template-columns: 1fr !important;
                 gap: calc(var(--form-spacing-unit) * 1.5) 0 !important;
                 padding: calc(var(--form-spacing-unit) * 1.5) !important;
             }
             .edit-receiver-info-form .grid-label,
             .edit-receiver-info-form .grid-label-col3,
             .edit-receiver-info-form .grid-label-full {
                 grid-column: 1 / -1 !important;
                 text-align: left !important;
                 padding-right: 0 !important;
                 margin-bottom: calc(var(--form-spacing-unit) * 0.5) !important;
                 padding-top: 0 !important;
                 white-space: normal !important;
             }
             .edit-receiver-info-form .grid-label.required::after {
                 position: relative !important; right: auto !important; top: auto !important; margin-left: 3px !important;
             }
             .edit-receiver-info-form .grid-control,
             .edit-receiver-info-form .grid-control-span3,
             .edit-receiver-info-form .grid-control-col4,
             .edit-receiver-info-form .grid-control-full {
                 grid-column: 1 / -1 !important;
             }
              .edit-receiver-info-form .group-country-postcode,
              .edit-receiver-info-form .group-city-state {
                   grid-template-columns: 1fr !important;
                   gap: calc(var(--form-spacing-unit) * 1.5) 0 !important;
              }
               .edit-receiver-info-form .group-country-postcode > .grid-label:nth-of-type(2),
               .edit-receiver-info-form .group-city-state > .grid-label:nth-of-type(2),
               .edit-receiver-info-form .group-country-postcode > .grid-control:nth-of-type(2),
               .edit-receiver-info-form .group-city-state > .grid-control:nth-of-type(2) {
                    grid-row: auto !important;
                    margin-top: 0 !important;
               }


             .edit-receiver-info-form .phone-group {
                 flex-direction: column !important; gap: var(--form-spacing-unit) !important; border: none !important; background: transparent !important; padding: 0 !important;
             }
             .edit-receiver-info-form .phone-part {
                 border: 1px solid var(--form-border-color) !important; border-radius: var(--form-border-radius) !important; overflow: hidden !important;
             }
              .edit-receiver-info-form .phone-part + .phone-part::before { display: none !important; }

             .edit-receiver-info-form .form-actions {
                 padding: var(--form-spacing-unit) calc(var(--form-spacing-unit) * 1.5) !important;
                 flex-direction: column-reverse !important;
                 align-items: stretch !important;
                 gap: calc(var(--form-spacing-unit) * 1) !important;
             }
             .edit-receiver-info-form .save-info-checkbox {
                 justify-content: center !important;
                 margin-bottom: var(--form-spacing-unit) !important;
             }
             .edit-receiver-info-form .action-buttons {
                 flex-direction: column-reverse !important; align-items: stretch !important; width: 100% !important; gap: calc(var(--form-spacing-unit) * 1) !important;
             }
             .edit-receiver-info-form .form-btn {
                 flex-grow: 1 !important; max-width: 100% !important; width: 100% !important;
             }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

    <div class="form-container edit-receiver-info-form">
        <div class="form-header">
            <h2>Chỉnh sửa thông tin người nhận</h2>
        </div>

        <form id="formReceiverInfoModal">
            <div class="form-body">

                <label for="receiverNameInputModal" class="grid-label required">Tên người nhận</label>
                <div class="grid-control grid-control-span3">
                     <input type="text" id="receiverNameInputModal" name="receiver_name" class="control-item" value="Alice the Alexander KPOP Woo Chun Pyoh Kamahamaha">
                </div>

                <label class="grid-label required">Số điện thoại</label>
                <div class="grid-control grid-control-span3">
                    <div class="phone-group">
                        <div class="phone-part">
                             <span class="country-code">+1</span>
                             <input type="tel" id="receiverPhone1NumberModal" name="phone1_number" class="control-item phone-input" value="(401) 426-1999">
                        </div>
                         <div class="phone-part">
                             <span class="country-code">+1</span>
                             <input type="tel" id="receiverPhone2NumberModal" name="phone2_number" class="control-item phone-input" value="(401) 417-1995">
                         </div>
                         <span class="phone-count">(2/2)</span>
                    </div>
                </div>

                 <label for="receiverCountryModal" class="grid-label required">Quốc gia</label>
                 <div class="grid-control">
                     <select id="receiverCountryModal" name="country_code" class="control-item">
                         <option value="">-- Chọn quốc gia --</option>
                         <option value="US" selected>UNITED STATES</option>
                         <option value="CA">CANADA</option>
                     </select>
                 </div>
                 <label for="receiverPostcodeModal" class="grid-label-col3">Postcode</label>
                 <div class="grid-control grid-control-col4">
                     <input type="text" id="receiverPostcodeModal" name="postal_code" class="control-item" value="02916">
                 </div>

                <label for="receiverCityModal" class="grid-label">Thành phố</label>
                <div class="grid-control">
                    <input type="text" id="receiverCityModal" name="city" class="control-item" value="Rumford">
                </div>
                <label for="receiverStateModal" class="grid-label-col3">Tỉnh/Bang</label>
                <div class="grid-control grid-control-col4">
                    <input type="text" id="receiverStateModal" name="state_province" class="control-item" value="Rhode Island">
                </div>

                 <label for="receiverAddressModal" class="grid-label grid-label-full required">Địa chỉ chi tiết</label>
                 <div class="grid-control grid-control-full">
                     <textarea id="receiverAddressModal" name="address_line1" class="control-item" rows="3">80 Don Avenue Rumford, Rhode Island 02916 US</textarea>
                     <span class="address-note">(Không nhập POSTCODE, STATE, CITY)</span>
                 </div>

                <label for="receiverNotesModal" class="grid-label grid-label-full">Ghi chú</label>
                <div class="grid-control grid-control-full">
                    <textarea id="receiverNotesModal" name="notes" class="control-item" rows="2">Nhận tại Bưu cục Rhode Island, tên chính thức Tiểu bang Rhode Island, là một tiểu bang nằm trong vùng New England của Hoa Kỳ</textarea>
                </div>

            </div>

            <div class="form-actions">
                 <label class="save-info-checkbox">
                     <input type="checkbox" name="save_receiver_info" value="1" checked>
                     <span>Lưu thông tin người nhận cho lần nhập tiếp theo</span>
                 </label>
                 <div class="action-buttons">
                     <button type="button" class="form-btn form-btn-cancel modal-cancel-button"><i class="fas fa-times"></i> Hủy</button>
                     <button type="button" class="form-btn form-btn-confirm modal-confirm-button"><i class="fas fa-check"></i> Xác nhận</button>
                 </div>
            </div>

        </form>
    </div>

</body>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log("Edit Receiver Info Modal - DOM Content Loaded");
    // Lấy dữ liệu từ localStorage
    const orderData = JSON.parse(localStorage.getItem('currentOrderDetail') || '{}');
    console.log("Edit Receiver Info Modal - Loaded data from localStorage:", orderData);
    
    // Các trường input trong form
    const form = document.getElementById('formReceiverInfoModal');
    const nameInput = document.getElementById('receiverNameInputModal');
    const phone1Input = document.getElementById('receiverPhone1NumberModal');
    const phone2Input = document.getElementById('receiverPhone2NumberModal');
    const countrySelect = document.getElementById('receiverCountryModal');
    const postcodeInput = document.getElementById('receiverPostcodeModal');
    const cityInput = document.getElementById('receiverCityModal');
    const stateInput = document.getElementById('receiverStateModal');
    const addressInput = document.getElementById('receiverAddressModal');
    const notesInput = document.getElementById('receiverNotesModal');
    
    // Load dữ liệu từ localStorage vào form
    if (orderData) {
        console.log("Edit Receiver Info Modal - Populating form fields with data");
        if (nameInput) {
            nameInput.value = orderData.receiver_name || '';
            console.log("Set receiver_name to:", orderData.receiver_name);
        }
        // Format số điện thoại khi load từ localStorage
        if (phone1Input) {
            const phone1 = orderData.receiver_phone1 || '';
            phone1Input.value = formatPhoneNumberForDisplay(phone1);
            console.log("Set receiver_phone1 to:", phone1);
        }
        if (phone2Input) {
            const phone2 = orderData.receiver_phone2 || '';
            phone2Input.value = formatPhoneNumberForDisplay(phone2);
            console.log("Set receiver_phone2 to:", phone2);
        }
        if (countrySelect) {
            countrySelect.value = orderData.receiver_country || 'US';
            console.log("Set receiver_country to:", orderData.receiver_country);
        }
        if (postcodeInput) {
            postcodeInput.value = orderData.receiver_postcode || '';
            console.log("Set receiver_postcode to:", orderData.receiver_postcode);
        }
        if (cityInput) {
            cityInput.value = orderData.receiver_city || '';
            console.log("Set receiver_city to:", orderData.receiver_city);
        }
        if (stateInput) {
            stateInput.value = orderData.receiver_state || '';
            console.log("Set receiver_state to:", orderData.receiver_state);
        }
        if (addressInput) {
            addressInput.value = orderData.receiver_address || '';
            console.log("Set receiver_address to:", orderData.receiver_address);
        }
        if (notesInput) {
            notesInput.value = orderData.receiver_notes || '';
            console.log("Set receiver_notes to:", orderData.receiver_notes);
        }
    }

    // Hàm format số điện thoại để hiển thị
    function formatPhoneNumberForDisplay(phone) {
        // Loại bỏ tất cả ký tự không phải số
        const cleaned = phone.replace(/\D/g, '');
        if (cleaned.length === 0) return '';
        // Format: (XXX) XXX-XXXX
        return `(${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6, 10)}`;
    }

    // Hàm chuyển số điện thoại về dạng số thuần túy
    function cleanPhoneNumber(phone) {
        return phone.replace(/\D/g, '');
    }

    // Xử lý sự kiện khi nhấn nút Xác nhận
    const confirmButton = document.querySelector('.modal-confirm-button');
    if (confirmButton) {
        confirmButton.addEventListener('click', function() {
            // Lấy dữ liệu từ form
            const formData = new FormData(form);
            const receiverData = Object.fromEntries(formData.entries());
            
            // Cập nhật dữ liệu vào orderData
            const updatedOrderData = {
                ...orderData,
                receiver_name: receiverData.receiver_name,
                // Lưu số điện thoại dưới dạng số thuần túy
                receiver_phone1: cleanPhoneNumber(receiverData.phone1_number),
                receiver_phone2: cleanPhoneNumber(receiverData.phone2_number),
                receiver_country: receiverData.country_code,
                receiver_postcode: receiverData.postal_code,
                receiver_city: receiverData.city,
                receiver_state: receiverData.state_province,
                receiver_address: receiverData.address_line1,
                receiver_notes: receiverData.notes
            };
            
            // Lưu vào localStorage
            localStorage.setItem('currentOrderDetail', JSON.stringify(updatedOrderData));
            
            // Cập nhật hiển thị trên trang chính
            const receiverNameDisplay = document.getElementById('receiverNameValue');
            const receiverPhonesDisplay = document.getElementById('receiverPhonesValue');
            const receiverAddressDisplay = document.getElementById('receiverAddressValue');
            
            if (receiverNameDisplay) receiverNameDisplay.textContent = updatedOrderData.receiver_name;
            if (receiverPhonesDisplay) {
                let phoneStr = formatPhoneNumberForDisplay(updatedOrderData.receiver_phone1);
                if (updatedOrderData.receiver_phone2) {
                    phoneStr += ` / ${formatPhoneNumberForDisplay(updatedOrderData.receiver_phone2)}`;
                }
                receiverPhonesDisplay.textContent = phoneStr;
            }
            if (receiverAddressDisplay) receiverAddressDisplay.textContent = updatedOrderData.receiver_address;
            
            // Thông báo thành công
            alert('Đã cập nhật thông tin người nhận thành công!');
            
            // Đóng modal
            if (typeof window.closeEditModal === 'function') {
                window.closeEditModal();
            }
        });
    }

    // Xử lý sự kiện khi nhấn nút Hủy
    const cancelButton = document.querySelector('.modal-cancel-button');
    if (cancelButton) {
        cancelButton.addEventListener('click', function() {
            if (typeof window.closeEditModal === 'function') {
                window.closeEditModal();
            }
        });
    }

    // Xử lý format số điện thoại khi nhập
    function formatPhoneNumber(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length > 0) {
            value = formatPhoneNumberForDisplay(value);
        }
        input.value = value;
    }

    // Thêm sự kiện format cho các input số điện thoại
    if (phone1Input) {
        phone1Input.addEventListener('input', function() {
            formatPhoneNumber(this);
        });
    }
    if (phone2Input) {
        phone2Input.addEventListener('input', function() {
            formatPhoneNumber(this);
        });
    }

    // Validate form trước khi submit
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (!nameInput.value.trim()) {
            alert('Vui lòng nhập tên người nhận');
            nameInput.focus();
            return false;
        }
        if (!phone1Input.value.trim()) {
            alert('Vui lòng nhập số điện thoại');
            phone1Input.focus();
            return false;
        }
        if (!countrySelect.value) {
            alert('Vui lòng chọn quốc gia');
            countrySelect.focus();
            return false;
        }
        if (!addressInput.value.trim()) {
            alert('Vui lòng nhập địa chỉ chi tiết');
            addressInput.focus();
            return false;
        }
        return true;
    });
});
</script>
</html>